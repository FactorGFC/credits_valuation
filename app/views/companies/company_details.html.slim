= stylesheet_pack_tag 'application'
javascript:

    function calculate_comparative(table_id) {

        if (document.getElementById(table_id) != null){

            //$("table#comparative_table").hide();
            var colMax = 0;
            var all_col = document.getElementsByClassName('col-comp');
            var titles = [];
            var noCols = $("table#" + table_id + " tr.tr-rdata:first").children('td.sum_input').filter(function () {
                return $(this).css('display') !== 'none';
            }).length;

            if (noCols !== 2) {
                for (var i = 0; i < all_col.length; i++) {
                    all_col[i].style.display = "none";
                }
                document.getElementById("col-comp_head_" + table_id).style.display = "none";
            } else {
                $("table#" + table_id + " tr.tr-title").children('th.th-title').filter(function () {
                    return $(this).css('display') !== 'none';
                }).each(function () {
                    titles.push($(this).text().split(" ")[0]);
                });

                //****Evalua si pertenecen al mismo periodo en base a la primera palabra del th***//
                if (titles.every((val, ind, arr) => val === arr[0])) {
                    if (titles[0].toLowerCase() === 'anual') {
                        $('div.percentage-badge.blue-badge').show();
                    } else {
                        $('div.percentage-badge.blue-badge').hide();
                    }
                    for (var i = 0; i < all_col.length; i++) {
                        all_col[i].style.display = "table-cell";
                    }
                    document.getElementById("col-comp_head_" + table_id).style.display = "table-cell";
                }
            }

            $("table#" + table_id + " tr.tr-rdata").each(function (index, tb_row) {
                var percent_values_array = [];
                var max_num = 0;
                var min_num = 0;
                var percent_value = 0;

                var columns = $(tb_row).children('td.sum_input').filter(function () {
                    return $(this).css('display') !== 'none';
                });
                var rowTotal = 0;

                colMax = columns.length;

                for (var col = 0; col < colMax; col++) {
                    if (columns.eq(col).css('display') !== 'none') {
                        var colData = parseFloat(columns.eq(col).find('span.td-value' + index).text());
                        var colPercent = columns.eq(col).find('span.percent-value' + index).text().split(" ")[0];
                        percent_values_array.push(colPercent);
                        if (!isNaN(colData)) {
                            if (col === 0){
                                rowTotal = colData;
                            } else {
                                rowTotal -= colData;
                            }
                        } else {
                            rowTotal = null;
                            break;
                        }
                    }
                };

                max_num = Math.max(...percent_values_array);
                min_num = Math.min(...percent_values_array);

                if(min_num == 0){
                    percent_value = ((max_num - min_num) / 1) * 100;
                }else{
                    percent_value = ((max_num - min_num) / min_num) * 100;
                }

                if (Number.isFinite(percent_value) && percent_value) {
                    $('span.percent_t' + index).text(percent_value.toFixed(2) + ' %');
                } else {
                    $('span.percent_t' + index).text('+100 %');
                }

                if (rowTotal !== null) {
                    console.log();

                    $('span.total_p' + index).text(rowTotal.toLocaleString());
                    $('span.percent_t' + index).show();
                    $('span.scale' + index).show();
                    $('span.total_p' + index).closest('td').removeClass("bg-lines");
                } else {
                    $('span.total_p' + index).text('');
                    if (titles.length > 0) {
                        if (titles[0].toLowerCase() != 'anual') {
                            $('span.total_p' + index).closest('td').addClass("bg-lines");
                        }
                    }
                    $('span.scale' + index).hide();
                    $('span.percent_t' + index).hide();
                }
            });

            var rowMax = ($("table#" + table_id + " tr.tr-rdata").length) / 2;

            for (var row = 0; row < rowMax; row++) {
                var values_array = [];
                var max_num = 0;
                var min_num = 0;
                var percent_value = 0;
                var rowData = '';

                for (var col = 0; col < colMax; col++) {
                    if ($('span#' + table_id + '.percent-bdg' + row + '-' + col).closest('td.sum_input').css('display') !== 'none') {
                        rowData = $('span#' + table_id + '.percent-bdg' + row + '-' + col).text();
                        values_array.push(parseFloat(rowData));
                    }
                }

                max_num = Math.max(...values_array);
                min_num = Math.min(...values_array);
                percent_value = ((max_num - min_num) / min_num) * 100;

                $('span.tb-badge' + row).text(percent_value.toFixed(2) + ' %');
            }

            //$("table#comparative_table").show();
        }

    }





.col-xl-12
  .d-flex.align-items-center
    .mr-auto.d-flex.align-items-center
      a.m-nav__link.m-nav__link--icon.mx-2.pb-2 href="/login" style="font-size: 20px;"
        i.fa.fa-chevron-circle-left
      h3.m-subheader__title.m-subheader__title--separator
        | Compañías

.col-xl-12.mt-20
  .portlet-profile.d-flex.justify-content-end
    .info-profile-container
      .icon-circle.d-flex.justify-content-end.align-items-center.px-5
        i.fa.fa-id-card.fa-4x style="position: relative;"
      .d-flex.flex-column.col-md-12.mb-2
        .col-md-12
          span.port-title = @company_name
          span = @company.rfc
      .d-flex.col-md-12
        .col-md-4
          span.port-subtitle = 'Estado / Municipio'
          span = @company_state_municipality
          span.port-subtitle = 'Dirección'
          span = @company_address
          span.port-subtitle = 'Estatus'
          span.status-pill class="#{render_status_by_class(@company.try(:status_company).try(:key))}"
            = @company.try(:status_company).present? ? @company.try(:status_company).try(:name): 'PENDIENTE DE REVISIÓN X FACTOR'
        .vl
        .col-md-4
          span.port-subtitle = 'Nombre de contacto'
          span = @company.try(:user).try(:full_name)
          span.port-subtitle = 'Teléfono de contacto'
          span = @company.try(:user).try(:phone)
          span.port-subtitle = 'Correo de contacto'
          span = @company.try(:user).try(:email)
        .col-md-4
          span.port-subtitle = 'Actividad Principal'
          span = @company.main_activity
          span.port-subtitle = 'Principales Productos/Servicios'
          - @company.main_product_list.each do |e|
            span.tag
              = "#{e}"
  .portlet-profile.d-flex
    .col-md-12.d-flex
      .col-md-7
        - unless @company.try(:client_type).eql?('PM')
          span.port-subtitle = 'INSTITUCIONES FINANCIERAS'
          button.btn.btn-primary.btn-block.my-2.open-modal1 data-target="#m_modal_financial_institutions" data-toggle="modal" type="button"
            = "Ver instituciones financieras"

        span.port-subtitle.mt-4 = 'COLABORADORES'
        ul.col-md-12.d-flex.justify-content-between.align-items-center.collab-list
          li.d-flex.flex-column.align-items-center.col-md-2
            span.d-flex.justify-content-center.align-items-center.quantity-circle = render_quantity_h @company.try(:number_collaborator).try(:operative)
            span.quantity-num
              strong = 'OPERATIVOS'
          li.d-flex.flex-column.align-items-center.col-md-2
            span.d-flex.justify-content-center.align-items-center.quantity-circle = render_quantity_h @company.try(:number_collaborator).try(:administrative)
            span.quantity-num
              strong = 'ADMINISTRATIVOS'
          li.d-flex.flex-column.align-items-center.col-md-2
            span.d-flex.justify-content-center.align-items-center.quantity-circle = render_quantity_h @company.try(:number_collaborator).try(:sales)
            span.quantity-num
              strong = 'VENTAS'
          li.d-flex.flex-column.align-items-center.col-md-2
            span.d-flex.justify-content-center.align-items-center.quantity-circle = render_quantity_h @company.try(:number_collaborator).try(:eventual)
            span.quantity-num
              strong = 'EVENTUAL'
          li.d-flex.flex-column.align-items-center.col-md-2
            span.d-flex.justify-content-center.align-items-center.quantity-circle = render_quantity_h @company.try(:number_collaborator).try(:unionized)
            span.quantity-num
              strong = 'SINDICALIZADOS'
        ul.d-flex.justify-content-center.collab-list
          h3
            strong = "TOTAL:  #{ @company.try(:number_collaborator).present?  ? @company.try(:number_collaborator).try(:total).to_s(:delimited) : 0 }"

      .col-md-5
        span.port-subtitle = 'ARCHIVOS'
        .d-flex.flex-column
          - if @company.try(:company_file).present?
            - if @company.try(:company_file).try(:invoice_id_file).present?
              a.btn.btn-outline-accent.m-btn.m-btn--icon.m-btn--outline-2x.my-1 href="#{ENV['DOWNLOAD_FILES']}/#{@company.try(:company_file).try(:invoice_id_file)}/#{@company.try(:company_file).try(:name_id_file)}" target="_blank"
                span.d-flex.justify-content-between.align-items-center
                  span
                    | Identificación oficial
                  i.fa.fa-file
            - else
              a.btn.btn-outline-accent.m-btn.m-btn--icon.m-btn--outline-2x.my-1.disabled href="#" target="_blank"
                span.d-flex.justify-content-between.align-items-center
                  span
                    | Identificación oficial
                  i.fa.fa-file
            - if @company.try(:company_file).try(:invoice_constancy).present?
              a.btn.btn-outline-accent.m-btn.m-btn--icon.m-btn--outline-2x.my-1 href="#{ENV['DOWNLOAD_FILES']}/#{@company.try(:company_file).try(:invoice_constancy)}/#{@company.try(:company_file).try(:name_constancy)}" target="_blank"
                span.d-flex.justify-content-between.align-items-center
                  span
                    | Constancia de Situacion fiscal
                  i.fa.fa-file
            - else
              a.btn.btn-outline-accent.m-btn.m-btn--icon.m-btn--outline-2x.my-1.disabled href="#" target="_blank"
                span.d-flex.justify-content-between.align-items-center
                  span
                    | Constancia de Situacion fiscal
                  i.fa.fa-file
            - if @company.try(:company_file).try(:invoice_financial_statements_one).present?
              a.btn.btn-outline-accent.m-btn.m-btn--icon.m-btn--outline-2x.my-1 href="#{ENV['DOWNLOAD_FILES']}/#{@company.try(:company_file).try(:invoice_financial_statements_one)}/#{@company.try(:company_file).try(:name_financial_statements_one)}" target="_blank"
                span.d-flex.justify-content-between.align-items-center
                  span
                    | Estados Financieros (Cierre anual 1)
                  i.fa.fa-file
            - else
              a.btn.btn-outline-accent.m-btn.m-btn--icon.m-btn--outline-2x.my-1.disabled href="#" target="_blank"
                span.d-flex.justify-content-between.align-items-center
                  span
                    | Estados Financieros (Cierre anual 1)
                  i.fa.fa-file
            - if @company.try(:company_file).try(:invoice_financial_statements_two).present?
              a.btn.btn-outline-accent.m-btn.m-btn--icon.m-btn--outline-2x.my-1 href="#{ENV['DOWNLOAD_FILES']}/#{@company.try(:company_file).try(:invoice_financial_statements_two)}/#{@company.try(:company_file).try(:name_financial_statements_two)}" target="_blank"
                span.d-flex.justify-content-between.align-items-center
                  span
                    | Estados Financieros (Cierre anual 2)
                  i.fa.fa-file
            - else
              a.btn.btn-outline-accent.m-btn.m-btn--icon.m-btn--outline-2x.my-1.disabled href="#" target="_blank"
                span.d-flex.justify-content-between.align-items-center
                  span
                    | Estados Financieros (Cierre anual 2)
                  i.fa.fa-file
            - if @company.try(:company_file).try(:invoice_financial_statements_parcial).present?
              a.btn.btn-outline-accent.m-btn.m-btn--icon.m-btn--outline-2x.my-1 href="#{ENV['DOWNLOAD_FILES']}/#{@company.try(:company_file).try(:invoice_financial_statements_parcial)}/#{@company.try(:company_file).try(:name_financial_statements_parcial)}" target="_blank"
                span.d-flex.justify-content-between.align-items-center
                  span
                    | Estados Financieros (Cierre parcial)
                  i.fa.fa-file
            - else
              a.btn.btn-outline-accent.m-btn.m-btn--icon.m-btn--outline-2x.my-1.disabled href="#" target="_blank"
                span.d-flex.justify-content-between.align-items-center
                  span
                    | Estados Financieros (Cierre parcial)
                  i.fa.fa-file

          - else
            h5 = 'Sin archivos por mostrar'
  .m-portlet
    .m-portlet__head
      .m-portlet__head-caption
        .m-portlet__head-title
          h3.m-portlet__head-text
            | Configuraciones

    .m-portlet__body
      .m-section.mb-0
        .d-inline-flex.col-md-12
          .col-md-8
            .btns-card.full-h
              .subtitle-icon.d-flex.justify-content-center.align-items-center
                i.fa.fa-building.fa-lg.m--font-primary
              h5.h5.subtitle = 'Detalles de solicitud'
              - if (current_user.god? or current_user.credit_management? or current_user.credit_area? or current_user.promotion_area?)
                button.btn.btn-outline-primary.m-btn.m-btn--outline-2x.btn-block.my-2.open-modal-request data-target="#m_modal_request_details" data-toggle="modal" type="button" data-id="#{nil}" data-companyid="#{@company.id}" data-process-status="#{nil}" data-analyst-id="#{nil}" data-factorcredit-id="#{nil}"
                  i.fa.fa-plus.left.mr-10
                  = "Nueva solicitud"
              .m-section__content.table-responsive.max-h-card
                table.table.m-table.m-table--head-separator-brand.table-custom
                  thead.thead-default.thead-custom
                    tr style="text-align: center;"
                      th
                        | Analista
                      th
                        | Crédito
                      th
                        | Estatus de Proceso
                      th
                    tbody
                      - @requests.each do |request|
                        tr
                          td.align-vm
                            = request.analist.try(:full_name)
                          td.align-vm
                            = request.factor_credit.try(:name).present? ? request.factor_credit.try(:name) : 'Sin asignar'
                          td.align-vm
                            = request.process_status.try(:name)
                          td.d-inline-flex
                            button.btn.btn-primary.m-btn.m-btn--icon.m-btn--icon-only.m-btn--pill.rounded-circle.mr-10.open-modal-request data-target="#m_modal_request_details" data-toggle="modal" type="button" data-id="#{request.id}" data-companyid="#{@company.id}" data-process-status="#{request.process_status.to_json}" data-analyst-id="#{request.analyst_id}" data-factorcredit-id="#{request.factor_credit_id}"
                              i.fa.fa-pencil-alt
                            a.btn.btn-primary.m-btn.m-btn--icon.m-btn--icon-only.m-btn--pill.rounded-circle.d-flex.justify-content-center.align-items-center href="/request_comments/#{request.id}"
                              i.fa.fa-comment
                            button.btn.btn-primary.m-btn.m-btn--icon.m-btn--icon-only.m-btn--pill.rounded-circle.mr-10.open-modal-file-request data-target="#m_modal_file_request" data-toggle="modal" type="button" data-id="#{request.id}"
                              i.fa.fa-file-pdf
                            - if request.try(:file_id).present?
                              a.btn.btn-danger.m-btn.m-btn--icon.m-btn--icon-only.m-btn--pill.rounded-circle.mr-10.open-modal-file-request href="#{ENV['DOWNLOAD_FILES']}/#{request.try(:file_id)}/#{request.try(:file_name)}" target="_blank"
                                i.fa.fa-eye
          .col-md-4
            .btns-card
              .subtitle-icon.d-flex.justify-content-center.align-items-center
                i.fa.fa-calendar.fa-lg.m--font-primary
              h5.h5.subtitle = 'Asignación de periodos'
              - if @company.status_company.key == 'aprobada'
                button.btn.btn-outline-primary.m-btn.m-btn--outline-2x.btn-block.my-2.open-modal1 data-target="#m_modal_periods" data-toggle="modal" type="button" data-id="#{@company.id}" data-calendars="#{@company.company_calendar_details.where(assign_to: 'balance_sheet').pluck(:calendar_id)}" data-approved="true"
                  = "Asignar periodos"
                /button.btn.btn-outline-primary.m-btn.m-btn--outline-2x.btn-block.my-2.open-modal1 data-target="#m_modal_income" data-toggle="modal" type="button" data-id="#{@company.id}" data-assignto="income_statement" data-calendars="#{@company.company_calendar_details.where(assign_to: 'income_statement').pluck(:calendar_id)}" data-approved="true"
                /  = "Estado Resultados"

            .btns-card.mt-30
              .subtitle-icon.d-flex.justify-content-center.align-items-center
                i.fa.fa-sync.fa-lg.m--font-primary
              h5.h5.subtitle = 'Información faltante de compañía'
              - if @company.try(:info_company).present? and @company.try(:income_statment).present? and @company.try(:balance_sheet).present? and @company.try(:credit_bureaus).last.try(:bureau_info).present? and @company.try(:credit_bureaus).last.try(:bureau_report).present?
                span.text-center
                  | Todo en orden.
              - else
                - unless @company.try(:info_company).present?
                  = link_to sat_info_company_path(@company.id), method: :put, class: 'btn btn-outline-primary m-btn m-btn--outline-2x btn-block my-2' do
                    = "Información del SAT"
                - unless @company.try(:income_statment).present?
                  = link_to sat_income_statement_path(@company.id), method: :put, class: 'btn btn-outline-primary m-btn m-btn--outline-2x btn-block my-2' do
                    = "Estado de resultados"

                - unless @company.try(:balance_sheet).present?
                  = link_to sat_balance_sheet_path(@company.id), method: :put, class: 'btn btn-outline-primary m-btn m-btn--outline-2x btn-block my-2' do
                    = "Hoja de balance"
                - unless @company.try(:credit_bureaus).last.try(:bureau_info).present?
                  = link_to credit_bureau_info_path(@company.id), method: :put, class: 'btn btn-outline-primary m-btn m-btn--outline-2x btn-block my-2' do
                    = "Info. Buró de crédito"
                - unless @company.try(:credit_bureaus).last.try(:bureau_report).present?
                  = link_to credit_bureau_report_path(@company.id), method: :put, class: 'btn btn-outline-primary m-btn m-btn--outline-2x btn-block my-2' do
                    = "Reporte del buró de crédito"

          ///////COMENTARIOS
          /.col-md-3
            .btns-card.full-h
              .subtitle-icon.d-flex.justify-content-center.align-items-center
                i.fa.fa-comment.fa-lg.m--font-primary
              .d-flex.flex-column.justify-content-between
                h5.h5.subtitle = 'Comentarios'
                .max-h-card.m-widget3
                  - if @request_comments.length > 0
                    - @request_comments.each do |comment|
                      .m-widget3__item
                        .m-widget3__header
                          .m-widget3__info
                            span.m-widget3__username
                              = User.where(id: comment.user_id).try(:first).full_name
                              br
                              span.m--font-primary
                                = "#{comment.process_status.name}"
                            br
                            span.m-widget3__time
                              = comment.created_at.strftime('%d/%m/%Y,  %I:%M%p')

                        .m-widget3__body
                          p.m-widget3__text
                            = comment.comment
                  - else
                    .m-widget3__item
                      .m-widget3__body
                        p.m-widget3__text
                          .text-center
                            | Aún no hay comentarios.
                a.btn.btn-block.btn-info href="/request_comments/#{@company.id}"
                  | IR A COMENTARIOS
  - if true#@company.income_calendar_details.present? or @company.balance_calendar_details.present?
    .m-portlet
      .m-portlet__head
        .m-portlet__head-caption
          .m-portlet__head-title
            h3.m-portlet__head-text
              | Tablas de información
      .m-portlet__body
        .m-section.mb-0
          .col-xl-12.my-4
            ul.nav.select_form_switch role="tablist"
              li.nav-item.active
                a.nav-link data-toggle="tab" href="#balance_sheet" onclick="calculate_comparative('comparative_table_bs')"
                  | BALANCE FINANCIERO
              li.nav-item
                a.nav-link data-toggle="tab" href="#income_statement" onclick="calculate_comparative('comparative_table_is')"
                  | ESTADO DE RESULTADOS
              li.nav-item
                a.nav-link data-toggle="tab" href="#financial_reasons"
                  | RAZÓNES FINANCIERAS
              li.nav-item
                a.nav-link data-toggle="tab" href="#credit_bureau"
                  | BURÓ DE CRÉDITO
              li.nav-item
                a.nav-link data-toggle="tab" href="#info_sat"
                  | INFORMACIÓN DEL SAT
              li.nav-item
                a.nav-link data-toggle="tab" href="#providers_clients"
                  | PROVEEDORES Y CLIENTES
              li.nav-item
                a.nav-link data-toggle="tab" href="#cash_flow"
                  | FLUJO DE EFECTIVO
              li.slide
          .tab-content.col-xl-12.mb-30
            .tab-pane.active id="balance_sheet"
              .col-xl-12
                .m-portlet
                  .m-portlet__body
                    .m-section.mb-0
                      .m-section__content.table-responsive.text-center
                        - if @company.balance_sheet_finished
                          button.btn.btn-outline-primary.m-btn.m-btn--outline-2x.my-2.open-modal-cstatus data-toggle="modal" type="button" data-target="#m_modal_capture_status" data-id="#{@company.id}" data-type="balance_sheet"
                            = "Habilitar Captura"
                        a.btn.btn-outline-primary.m-btn.m-btn--outline-2x.my-2.btn-block href="/balance_sheet_request/#{@company.id}" target="_blank"
                          .fa.fa-pencil-alt
                          = "Editar Captura"
                      - if @company.company_calendar_details.where(assign_to: 'balance_sheet').present?
                        #wrapper
                          #checkbox_div
                            p.text-center Mostrar/Ocultar años
                            .d-flex style="justify-content: center; margin: 10px;"
                              - @calendar_periods_bs.each do |y|
                                .ck-button
                                  label
                                    input onchange="hide_show_table(this.id, 'comparative_table_bs');" type="checkbox" value="hide" checked="true" id="col-#{y.id}"
                                    span = y.calendar.period_name

                        /.m-loader.m-loader--brand style=("width: 30px; display: inline-block;")

                        table.table.table-bordered.input-focusable-table#comparative_table_bs
                          tr.tr-title
                            th
                            - @calendar_periods_bs.each do |y|
                              th.th-title id="col-#{y.id}_head"
                                = y.calendar.period_name
                            th id="col-comp_head_comparative_table_bs"
                              = 'COMPARACIÓN (ANUAL)'
                          tr
                            td.concept-header style=" font-weight: 800; font-size: 16px;" rowspan="2"
                              span.text-left = 'Activo circulante'
                            - @calendar_periods_bs.each_with_index do |y, y_index|
                              td.concept-header class="full-input col-#{y.id}"
                                - if y.calendar.period_type == 'anual'
                                  span = 'SUM. SAT'
                                  br
                                  span = company_balance_sheet_value(@company.id, y.calendar, ['1','2','3','4'], @bs_scale).to_s(:delimited)
                                  span.value-scale = @bs_scale
                            td.concept-header.col-comp
                          tr
                            - @calendar_periods_bs.each do |y|
                              td.concept-header class="full-input col-#{y.id}"
                                span = 'SUM. CAPTURA'
                                br
                                span = bs_capture_sum(@company.id, ['1','2','3','4'], y.calendar.id, @bs_scale).to_s(:delimited)
                                span.value-scale = @bs_scale
                            td.concept-header.col-comp
                          tr.tr-rdata
                            td style="font-weight: 600" rowspan="2"
                              span.text-left = 'Caja / Inversiones'
                            - @calendar_periods_bs.each_with_index do |y, y_index|
                              td.sum_input.sat_value class="full-input col-#{y.id}"
                                - if y.calendar.period_type == 'anual'
                                  div class=['percentage-badge', calculate_percentage('balance_sheet', @company.id, y.calendar, 1, @bs_scale)[1]]
                                    span#comparative_table_bs class=["percent-bdg0-#{y_index}"] = "#{calculate_percentage('balance_sheet', @company.id, y.calendar, 1, @bs_scale)[0]} %"
                                  span.text-table-concept = 'SAT'
                                  br
                                  span.td-value0 = company_balance_sheet_value(@company.id, y.calendar, 1, @bs_scale).to_s(:delimited)
                                  span.value-scale = @bs_scale
                                  span.float-percent.percent-value0 = "#{calculate_percent_of_total(company_balance_sheet_value(@company.id, y.calendar, 1, @bs_scale), company_balance_sheet_value(@company.id, y.calendar, ['1','2','3','4'], @bs_scale))} %"
                            td.full-input.total_p0.col-comp
                              div.percentage-badge.blue-badge
                                span.tb-badge0 = "0"
                              span.total_p0 = "0"
                              span.scale0.value-scale = @bs_scale
                              span.float-percent.percent_t0 = "0 %"
                          tr.tr-rdata
                            - @calendar_periods_bs.each do |y|
                              td.sum_input class="full-input col-#{y.id}"
                                span.text-table-concept = 'CAPTURA'
                                br
                                span.td-value1 = balance_calendar_detail_value(@company.id, y.calendar, 1, @bs_scale).to_s(:delimited)
                                span.value-scale = @bs_scale
                                span.float-percent.percent-value1 = "#{calculate_percent_of_total(balance_calendar_detail_value(@company.id, y.calendar, 1, @bs_scale), bs_capture_sum(@company.id, ['1','2','3','4'], y.calendar.id, @bs_scale))} %"
                            td.full-input.total_p1.col-comp
                              span.total_p1 = "0"
                              span.scale1.value-scale = @bs_scale
                              span.float-percent.percent_t1 = "0 %"
                          tr.tr-rdata
                            td style="font-weight: 600" rowspan="2"
                              span.text-left = 'Clientes'
                            - @calendar_periods_bs.each_with_index do |y, y_index|
                              td.sum_input class="full-input col-#{y.id}"
                                - if y.calendar.period_type == 'anual'
                                  div class=['percentage-badge', calculate_percentage('balance_sheet', @company.id, y.calendar, 2, @bs_scale)[1]]
                                    span#comparative_table_bs class=["percent-bdg1-#{y_index}"] = "#{calculate_percentage('balance_sheet', @company.id, y.calendar, 2, @bs_scale)[0]} %"
                                  span.text-table-concept = 'SAT'
                                  br
                                  span.td-value2 = company_balance_sheet_value(@company.id, y.calendar, 2, @bs_scale).to_s(:delimited)
                                  span.value-scale = @bs_scale
                                  span.float-percent.percent-value2 = "#{calculate_percent_of_total(company_balance_sheet_value(@company.id, y.calendar, 2, @bs_scale), company_balance_sheet_value(@company.id, y.calendar, ['1','2','3','4'], @bs_scale))} %"
                            td.full-input.total_p2.col-comp
                              div.percentage-badge.blue-badge
                                span.tb-badge1 = "0"
                              span.total_p2 = "0"
                              span.scale2.value-scale = @bs_scale
                              span.float-percent.percent_t2 = "0 %"
                          tr.tr-rdata
                            - @calendar_periods_bs.each do |y|
                              td.sum_input class="full-input col-#{y.id}"
                                span.text-table-concept = 'CAPTURA'
                                br
                                span.td-value3 = balance_calendar_detail_value(@company.id, y.calendar, 2, @bs_scale).to_s(:delimited)
                                span.value-scale = @bs_scale
                                span.float-percent.percent-value3 = "#{calculate_percent_of_total(balance_calendar_detail_value(@company.id, y.calendar, 2, @bs_scale), bs_capture_sum(@company.id, ['1','2','3','4'], y.calendar.id, @bs_scale))} %"
                            td.full-input.total_p3.col-comp
                              span.total_p3 = "0"
                              span.scale3.value-scale = @bs_scale
                              span.float-percent.percent_t3 = "0 %"
                          tr.tr-rdata
                            td style="font-weight: 600" rowspan="2"
                              span.text-left = 'Inventarios'
                            - @calendar_periods_bs.each_with_index do |y, y_index|
                              td.sum_input class="full-input col-#{y.id}"
                                - if y.calendar.period_type == 'anual'
                                  div class=['percentage-badge', calculate_percentage('balance_sheet', @company.id, y.calendar, 3, @bs_scale)[1]]
                                    span#comparative_table_bs class=["percent-bdg2-#{y_index}"] = "#{calculate_percentage('balance_sheet', @company.id, y.calendar, 3, @bs_scale)[0]} %"
                                  span.text-table-concept = 'SAT'
                                  br
                                  span.td-value4 = company_balance_sheet_value(@company.id, y.calendar, 3, @bs_scale).to_s(:delimited)
                                  span.value-scale = @bs_scale
                                  span.float-percent.percent-value4 = "#{calculate_percent_of_total(company_balance_sheet_value(@company.id, y.calendar, 3, @bs_scale), company_balance_sheet_value(@company.id, y.calendar, ['1','2','3','4'], @bs_scale))} %"
                            td.full-input.total_p4.col-comp
                              div.percentage-badge.blue-badge
                                span.tb-badge2 = "0"
                              span.total_p4 = "0"
                              span.scale4.value-scale = @bs_scale
                              span.float-percent.percent_t4 = "0 %"
                          tr.tr-rdata
                            - @calendar_periods_bs.each do |y|
                              td.sum_input class="full-input col-#{y.id}"
                                span.text-table-concept = 'CAPTURA'
                                br
                                span.td-value5 = balance_calendar_detail_value(@company.id, y.calendar, 3, @bs_scale).to_s(:delimited)
                                span.value-scale = @bs_scale
                                span.float-percent.percent-value6 = "#{calculate_percent_of_total(balance_calendar_detail_value(@company.id, y.calendar, 3, @bs_scale), bs_capture_sum(@company.id, ['1','2','3','4'], y.calendar.id, @bs_scale))} %"
                            td.full-input.total_p5.col-comp
                              span.total_p5 = "0"
                              span.scale5.value-scale = @bs_scale
                              span.float-percent.percent_t5 = "0 %"
                          tr.tr-rdata
                            td style="font-weight: 600" rowspan="2"
                              span.text-left = 'Otros activos circulantes'
                            - @calendar_periods_bs.each_with_index do |y, y_index|
                              td.sum_input class="full-input col-#{y.id}"
                                - if y.calendar.period_type == 'anual'
                                  div class=['percentage-badge', calculate_percentage('balance_sheet', @company.id, y.calendar, 4, @bs_scale)[1]]
                                    span#comparative_table_bs class=["percent-bdg3-#{y_index}"] = "#{calculate_percentage('balance_sheet', @company.id, y.calendar, 4, @bs_scale)[0]} %"
                                  span.text-table-concept = 'SAT'
                                  br
                                  span.td-value6 = company_balance_sheet_value(@company.id, y.calendar, 4, @bs_scale).to_s(:delimited)
                                  span.value-scale = @bs_scale
                                  span.float-percent.percent-value6 = "#{calculate_percent_of_total(company_balance_sheet_value(@company.id, y.calendar, 4, @bs_scale), company_balance_sheet_value(@company.id, y.calendar, ['1','2','3','4'], @bs_scale))} %"
                            td.full-input.total_p6.col-comp
                              div.percentage-badge.blue-badge
                                span.tb-badge3 = "0"
                              span.total_p6 = "0"
                              span.scale6.value-scale = @bs_scale
                              span.float-percent.percent_t6 = "0 %"
                          tr.tr-rdata
                            - @calendar_periods_bs.each do |y|
                              td.sum_input class="full-input col-#{y.id}"
                                span.text-table-concept = 'CAPTURA'
                                br
                                span.td-value7 = balance_calendar_detail_value(@company.id, y.calendar, 4, @bs_scale).to_s(:delimited)
                                span.value-scale = @bs_scale
                                span.float-percent.percent-value7 = "#{calculate_percent_of_total(balance_calendar_detail_value(@company.id, y.calendar, 4, @bs_scale), bs_capture_sum(@company.id, ['1','2','3','4'], y.calendar.id, @bs_scale))} %"
                            td.full-input.total_p7.col-comp
                              span.total_p7 = "0"
                              span.scale7.value-scale = @bs_scale
                              span.float-percent.percent_t7 = "0 %"

                          tr
                            td.concept-header style=" font-weight: 800; font-size: 18px" rowspan="2"
                              span.text-left = 'Activo fijo'
                            - @calendar_periods_bs.each do |y|
                              td.concept-header class="full-input col-#{y.id}"
                                - if y.calendar.period_type == 'anual'
                                  span = 'SUM. SAT'
                                  br
                                  span = bs_activo_fijo_sat(@company.id, ['5','6','8','9'], y.calendar, @bs_scale).to_s(:delimited)
                                  span.value-scale = @bs_scale
                            td.concept-header.col-comp
                          tr
                            - @calendar_periods_bs.each do |y|
                              td.concept-header class="full-input col-#{y.id}"
                                span = 'SUM. CAPTURA'
                                br
                                span = bs_activo_fijo(@company.id, ['5','6','8','9'], y.calendar.id, @bs_scale).to_s(:delimited)
                                span.value-scale = @bs_scale
                            td.concept-header.col-comp
                          tr.tr-rdata
                            td style="font-weight: 600" rowspan="2"
                              span.text-left = 'Terrenos y Construcciones'
                            - @calendar_periods_bs.each_with_index do |y, y_index|
                              td.sum_input class="full-input col-#{y.id}"
                                - if y.calendar.period_type == 'anual'
                                  div class=['percentage-badge', calculate_percentage('balance_sheet', @company.id, y.calendar, 5, @bs_scale)[1]]
                                    span#comparative_table_bs class=["percent-bdg4-#{y_index}"] = "#{calculate_percentage('balance_sheet', @company.id, y.calendar, 5, @bs_scale)[0]} %"
                                  span.text-table-concept = 'SAT'
                                  br
                                  span.td-value8 = company_balance_sheet_value(@company.id, y.calendar, 5, @bs_scale).to_s(:delimited)
                                  span.value-scale = @bs_scale
                                  span.float-percent.percent-value8 = "#{calculate_percent_of_total(company_balance_sheet_value(@company.id, y.calendar, 5, @bs_scale), company_balance_sheet_value(@company.id, y.calendar, ['5','6','7','8','9'], @bs_scale))} %"
                            td.full-input.total_p8.col-comp
                              div.percentage-badge.blue-badge
                                span.tb-badge4 = "0"
                              span.total_p8 = "0"
                              span.scale8.value-scale = @bs_scale
                              span.float-percent.percent_t8 = "0 %"
                          tr.tr-rdata
                            - @calendar_periods_bs.each do |y|
                              td.sum_input class="full-input col-#{y.id}"
                                span.text-table-concept = 'CAPTURA'
                                br
                                span.td-value9 = balance_calendar_detail_value(@company.id, y.calendar, 5, @bs_scale).to_s(:delimited)
                                span.value-scale = @bs_scale
                                span.float-percent.percent-value9 = "#{calculate_percent_of_total(balance_calendar_detail_value(@company.id, y.calendar, 5, @bs_scale), bs_capture_sum(@company.id, ['5','6','7','8','9'], y.calendar.id, @bs_scale))} %"
                            td.full-input.total_p9.col-comp
                              span.total_p9 = "0"
                              span.scale9.value-scale = @bs_scale
                              span.float-percent.percent_t9 = "0 %"
                          tr.tr-rdata
                            td style="font-weight: 600" rowspan="2"
                              span.text-left = 'Maquinaria y equipo'
                            - @calendar_periods_bs.each_with_index do |y, y_index|
                              td.sum_input class="full-input col-#{y.id}"
                                - if y.calendar.period_type == 'anual'
                                  div class=['percentage-badge', calculate_percentage('balance_sheet', @company.id, y.calendar, 6, @bs_scale)[1]]
                                    span#comparative_table_bs class=["percent-bdg5-#{y_index}"] = "#{calculate_percentage('balance_sheet', @company.id, y.calendar, 6, @bs_scale)[0]} %"
                                  span.text-table-concept = 'SAT'
                                  br
                                  span.td-value10 = company_balance_sheet_value(@company.id, y.calendar, 6, @bs_scale).to_s(:delimited)
                                  span.value-scale = @bs_scale
                                  span.float-percent.percent-value10 = "#{calculate_percent_of_total(company_balance_sheet_value(@company.id, y.calendar, 6, @bs_scale), company_balance_sheet_value(@company.id, y.calendar, ['5','6','7','8','9'], @bs_scale))} %"
                            td.full-input.total_p10.col-comp
                              div.percentage-badge.blue-badge
                                span.tb-badge5 = "0"
                              span.total_p10 = "0"
                              span.scale10.value-scale = @bs_scale
                              span.float-percent.percent_t10 = "0 %"
                          tr.tr-rdata
                            - @calendar_periods_bs.each do |y|
                              td.sum_input class="full-input col-#{y.id}"
                                span.text-table-concept = 'CAPTURA'
                                br
                                span.td-value11 = balance_calendar_detail_value(@company.id, y.calendar, 6, @bs_scale).to_s(:delimited)
                                span.value-scale = @bs_scale
                                span.float-percent.percent-value11 = "#{calculate_percent_of_total(balance_calendar_detail_value(@company.id, y.calendar, 6, @bs_scale), bs_capture_sum(@company.id, ['5','6','7','8','9'], y.calendar.id, @bs_scale))} %"
                            td.full-input.total_p11.col-comp
                              span.total_p11 = "0"
                              span.scale11.value-scale = @bs_scale
                              span.float-percent.percent_t11 = "0 %"
                          tr.tr-rdata
                            td style="font-weight: 600" rowspan="2"
                              span.text-left = 'Depreciación acumulada'
                            - @calendar_periods_bs.each_with_index do |y, y_index|
                              td.sum_input class="full-input col-#{y.id}"
                                - if y.calendar.period_type == 'anual'
                                  div class=['percentage-badge', calculate_percentage('balance_sheet', @company.id, y.calendar, 7, @bs_scale)[1]]
                                    span#comparative_table_bs class=["percent-bdg6-#{y_index}"] = "#{calculate_percentage('balance_sheet', @company.id, y.calendar, 7, @bs_scale)[0]} %"
                                  span.text-table-concept = 'SAT'
                                  br
                                  span.td-value12 = company_balance_sheet_value(@company.id, y.calendar, 7, @bs_scale).to_s(:delimited)
                                  span.value-scale = @bs_scale
                                  span.float-percent.percent-value12 = "#{calculate_percent_of_total(company_balance_sheet_value(@company.id, y.calendar, 7, @bs_scale), company_balance_sheet_value(@company.id, y.calendar, ['5','6','7','8','9'], @bs_scale))} %"
                            td.full-input.total_p12.col-comp
                              div.percentage-badge.blue-badge
                                span.tb-badge6 = "0"
                              span.total_p12 = "0"
                              span.scale12.value-scale = @bs_scale
                              span.float-percent.percent_t12 = "0 %"
                          tr.tr-rdata
                            - @calendar_periods_bs.each do |y|
                              td.sum_input class="full-input col-#{y.id}"
                                span.text-table-concept = 'CAPTURA'
                                br
                                span.td-value13 = balance_calendar_detail_value(@company.id, y.calendar, 7, @bs_scale).to_s(:delimited)
                                span.value-scale = @bs_scale
                                span.float-percent.percent-value13 = "#{calculate_percent_of_total(balance_calendar_detail_value(@company.id, y.calendar, 7, @bs_scale), bs_capture_sum(@company.id, ['5','6','7','8','9'], y.calendar.id, @bs_scale))} %"
                            td.full-input.total_p13.col-comp
                              span.total_p13 = "0"
                              span.scale13.value-scale = @bs_scale
                              span.float-percent.percent_t13 = "0 %"
                          tr.tr-rdata
                            td style="font-weight: 600" rowspan="2"
                              span.text-left = 'Otros activos fijos'
                            - @calendar_periods_bs.each_with_index do |y, y_index|
                              td.sum_input class="full-input col-#{y.id}"
                                - if y.calendar.period_type == 'anual'
                                  div class=['percentage-badge', calculate_percentage('balance_sheet', @company.id, y.calendar, 8, @bs_scale)[1]]
                                    span#comparative_table_bs class=["percent-bdg7-#{y_index}"] = "#{calculate_percentage('balance_sheet', @company.id, y.calendar, 8, @bs_scale)[0]} %"
                                  span.text-table-concept = 'SAT'
                                  br
                                  span.td-value14 = company_balance_sheet_value(@company.id, y.calendar, 8, @bs_scale).to_s(:delimited)
                                  span.value-scale = @bs_scale
                                  span.float-percent.percent-value14 = "#{calculate_percent_of_total(company_balance_sheet_value(@company.id, y.calendar, 8, @bs_scale), company_balance_sheet_value(@company.id, y.calendar, ['5','6','7','8','9'], @bs_scale))} %"
                            td.full-input.total_p14.col-comp
                              div.percentage-badge.blue-badge
                                span.tb-badge7 = "0"
                              span.total_p14 = "0"
                              span.scale14.value-scale = @bs_scale
                              span.float-percent.percent_t14 = "0 %"
                          tr.tr-rdata
                            - @calendar_periods_bs.each do |y|
                              td.sum_input class="full-input col-#{y.id}"
                                span.text-table-concept = 'CAPTURA'
                                br
                                span.td-value15 = balance_calendar_detail_value(@company.id, y.calendar, 8, @bs_scale).to_s(:delimited)
                                span.value-scale = @bs_scale
                                span.float-percent.percent-value15 = "#{calculate_percent_of_total(balance_calendar_detail_value(@company.id, y.calendar, 8, @bs_scale), bs_capture_sum(@company.id, ['5','6','7','8','9'], y.calendar.id, @bs_scale))} %"
                            td.full-input.total_p15.col-comp
                              span.total_p15 = "0"
                              span.scale15.value-scale = @bs_scale
                              span.float-percent.percent_t15 = "0 %"
                          tr.tr-rdata
                            td style="font-weight: 600" rowspan="2"
                              span.text-left = 'Cargos y gastos diferidos'
                            - @calendar_periods_bs.each_with_index do |y, y_index|
                              td.sum_input class="full-input col-#{y.id}"
                                - if y.calendar.period_type == 'anual'
                                  div class=['percentage-badge', calculate_percentage('balance_sheet', @company.id, y.calendar, 9, @bs_scale)[1]]
                                    span#comparative_table_bs class=["percent-bdg8-#{y_index}"] = "#{calculate_percentage('balance_sheet', @company.id, y.calendar, 9, @bs_scale)[0]} %"
                                  span.text-table-concept = 'SAT'
                                  br
                                  span.td-value16 = company_balance_sheet_value(@company.id, y.calendar, 9, @bs_scale).to_s(:delimited)
                                  span.value-scale = @bs_scale
                                  span.float-percent.percent-value16 = "#{calculate_percent_of_total(company_balance_sheet_value(@company.id, y.calendar, 9, @bs_scale), company_balance_sheet_value(@company.id, y.calendar, ['5','6','7','8','9'], @bs_scale))} %"
                            td.full-input.total_p16.col-comp
                              div.percentage-badge.blue-badge
                                span.tb-badge8 = "0"
                              span.total_p16 = "0"
                              span.scale16.value-scale = @bs_scale
                              span.float-percent.percent_t16 = "0 %"
                          tr.tr-rdata
                            - @calendar_periods_bs.each do |y|
                              td.sum_input class="full-input col-#{y.id}"
                                span.text-table-concept = 'CAPTURA'
                                br
                                span.td-value17 = balance_calendar_detail_value(@company.id, y.calendar, 9, @bs_scale).to_s(:delimited)
                                span.value-scale = @bs_scale
                                span.float-percent.percent-value17 = "#{calculate_percent_of_total(balance_calendar_detail_value(@company.id, y.calendar, 9, @bs_scale), bs_capture_sum(@company.id, ['5','6','7','8','9'], y.calendar.id, @bs_scale))} %"
                            td.full-input.total_p17.col-comp
                              span.total_p17 = "0"
                              span.scale17.value-scale = @bs_scale
                              span.float-percent.percent_t17 = "0 %"

                          tr
                            td.concept-header style=" font-weight: 800; font-size: 18px" rowspan="2"
                              span.text-left = 'Pasivo total'
                            - @calendar_periods_bs.each do |y|
                              td.concept-header class="full-input col-#{y.id}"
                                - if y.calendar.period_type == 'anual'
                                  span = 'SUM. SAT'
                                  br
                                  span = company_balance_sheet_value(@company.id, y.calendar, ['10','11','12','13'], @bs_scale).to_s(:delimited)
                                  span.value-scale = @bs_scale
                            td.concept-header.col-comp
                          tr
                            - @calendar_periods_bs.each do |y|
                              td.concept-header class="full-input col-#{y.id}"
                                span = 'SUM. CAPTURA'
                                br
                                span = bs_capture_sum(@company.id, ['10','11','12','13'], y.calendar.id, @bs_scale).to_s(:delimited)
                                span.value-scale = @bs_scale
                            td.concept-header.col-comp
                          tr.tr-rdata
                            td style="font-weight: 600" rowspan="2"
                              span.text-left = 'Proveedores'
                            - @calendar_periods_bs.each_with_index do |y, y_index|
                              td.sum_input class="full-input col-#{y.id}"
                                - if y.calendar.period_type == 'anual'
                                  div class=['percentage-badge', calculate_percentage('balance_sheet', @company.id, y.calendar, 10, @bs_scale)[1]]
                                    span#comparative_table_bs class=["percent-bdg9-#{y_index}"] = "#{calculate_percentage('balance_sheet', @company.id, y.calendar, 10, @bs_scale)[0]} %"
                                  span.text-table-concept = 'SAT'
                                  br
                                  span.td-value18 = company_balance_sheet_value(@company.id, y.calendar, 10, @bs_scale).to_s(:delimited)
                                  span.value-scale = @bs_scale
                                  span.float-percent.percent-value18 = "#{calculate_percent_of_total(company_balance_sheet_value(@company.id, y.calendar, 10, @bs_scale), company_balance_sheet_value(@company.id, y.calendar, ['10','11','12','13'], @bs_scale))} %"
                            td.full-input.total_p18.col-comp
                              div.percentage-badge.blue-badge
                                span.tb-badge9 = "0"
                              span.total_p18 = "0"
                              span.scale18.value-scale = @bs_scale
                              span.float-percent.percent_t18 = "0 %"
                          tr.tr-rdata
                            - @calendar_periods_bs.each do |y|
                              td.sum_input class="full-input col-#{y.id}"
                                span.text-table-concept = 'CAPTURA'
                                br
                                span.td-value19 = balance_calendar_detail_value(@company.id, y.calendar, 10, @bs_scale).to_s(:delimited)
                                span.value-scale = @bs_scale
                                span.float-percent.percent-value19 = "#{calculate_percent_of_total(balance_calendar_detail_value(@company.id, y.calendar, 10, @bs_scale), bs_capture_sum(@company.id, ['10','11','12','13'], y.calendar.id, @bs_scale))} %"
                            td.full-input.total_p19.col-comp
                              span.total_p19 = "0"
                              span.scale19.value-scale = @bs_scale
                              span.float-percent.percent_t19 = "0 %"
                          tr.tr-rdata
                            td style="font-weight: 600" rowspan="2"
                              span.text-left = 'Contribuciones por pagar'
                            - @calendar_periods_bs.each_with_index do |y, y_index|
                              td.sum_input class="full-input col-#{y.id}"
                                - if y.calendar.period_type == 'anual'
                                  div class=['percentage-badge', calculate_percentage('balance_sheet', @company.id, y.calendar, 11, @bs_scale)[1]]
                                    span#comparative_table_bs class=["percent-bdg10-#{y_index}"] = "#{calculate_percentage('balance_sheet', @company.id, y.calendar, 11, @bs_scale)[0]} %"
                                  span.text-table-concept = 'SAT'
                                  br
                                  span.td-value20 = company_balance_sheet_value(@company.id, y.calendar, 11, @bs_scale).to_s(:delimited)
                                  span.value-scale = @bs_scale
                                  span.float-percent.percent-value20 = "#{calculate_percent_of_total(company_balance_sheet_value(@company.id, y.calendar, 11, @bs_scale), company_balance_sheet_value(@company.id, y.calendar, ['10','11','12','13'], @bs_scale))} %"
                            td.full-input.total_p20.col-comp
                              div.percentage-badge.blue-badge
                                span.tb-badge10 = "0"
                              span.total_p20 = "0"
                              span.scale20.value-scale = @bs_scale
                              span.float-percent.percent_t20 = "0 %"
                          tr.tr-rdata
                            - @calendar_periods_bs.each do |y|
                              td.sum_input class="full-input col-#{y.id}"
                                span.text-table-concept = 'CAPTURA'
                                br
                                span.td-value21 = balance_calendar_detail_value(@company.id, y.calendar, 11, @bs_scale).to_s(:delimited)
                                span.value-scale = @bs_scale
                                span.float-percent.percent-value21 = "#{calculate_percent_of_total(balance_calendar_detail_value(@company.id, y.calendar, 11, @bs_scale), bs_capture_sum(@company.id, ['10','11','12','13'], y.calendar.id, @bs_scale))} %"
                            td.full-input.total_p21.col-comp
                              span.total_p21 = "0"
                              span.scale21.value-scale = @bs_scale
                              span.float-percent.percent_t21 = "0 %"
                          tr.tr-rdata
                            td style="font-weight: 600" rowspan="2"
                              span.text-left = 'Anticipo de clientes'
                            - @calendar_periods_bs.each_with_index do |y, y_index|
                              td.sum_input class="full-input col-#{y.id}"
                                - if y.calendar.period_type == 'anual'
                                  div class=['percentage-badge', calculate_percentage('balance_sheet', @company.id, y.calendar, 12, @bs_scale)[1]]
                                    span#comparative_table_bs class=["percent-bdg11-#{y_index}"] = "#{calculate_percentage('balance_sheet', @company.id, y.calendar, 12, @bs_scale)[0]} %"
                                  span.text-table-concept = 'SAT'
                                  br
                                  span.td-value22 = company_balance_sheet_value(@company.id, y.calendar, 12, @bs_scale).to_s(:delimited)
                                  span.value-scale = @bs_scale
                                  span.float-percent.percent-value22 = "#{calculate_percent_of_total(company_balance_sheet_value(@company.id, y.calendar, 12, @bs_scale), company_balance_sheet_value(@company.id, y.calendar, ['10','11','12','13'], @bs_scale))} %"
                            td.full-input.total_p22.col-comp
                              div.percentage-badge.blue-badge
                                span.tb-badge11 = "0"
                              span.total_p22 = "0"
                              span.scale22.value-scale = @bs_scale
                              span.float-percent.percent_t22 = "0 %"
                          tr.tr-rdata
                            - @calendar_periods_bs.each do |y|
                              td.sum_input class="full-input col-#{y.id}"
                                span.text-table-concept = 'CAPTURA'
                                br
                                span.td-value23 = balance_calendar_detail_value(@company.id, y.calendar, 12, @bs_scale).to_s(:delimited)
                                span.value-scale = @bs_scale
                                span.float-percent.percent-value23 = "#{calculate_percent_of_total(balance_calendar_detail_value(@company.id, y.calendar, 12, @bs_scale), bs_capture_sum(@company.id, ['10','11','12','13'], y.calendar.id, @bs_scale))} %"
                            td.full-input.total_p23.col-comp
                              span.total_p23 = "0"
                              span.scale23.value-scale = @bs_scale
                              span.float-percent.percent_t23 = "0 %"
                          tr.tr-rdata
                            td style="font-weight: 600" rowspan="2"
                              span.text-left = 'Otros pasivos'
                            - @calendar_periods_bs.each_with_index do |y, y_index|
                              td.sum_input class="full-input col-#{y.id}"
                                - if y.calendar.period_type == 'anual'
                                  div class=['percentage-badge', calculate_percentage('balance_sheet', @company.id, y.calendar, 13, @bs_scale)[1]]
                                    span#comparative_table_bs class=["percent-bdg12-#{y_index}"] = "#{calculate_percentage('balance_sheet', @company.id, y.calendar, 13, @bs_scale)[0]} %"
                                  span.text-table-concept = 'SAT'
                                  br
                                  span.td-value24 = company_balance_sheet_value(@company.id, y.calendar, 13, @bs_scale).to_s(:delimited)
                                  span.value-scale = @bs_scale
                                  span.float-percent.percent-value24 = "#{calculate_percent_of_total(company_balance_sheet_value(@company.id, y.calendar, 13, @bs_scale), company_balance_sheet_value(@company.id, y.calendar, ['10','11','12','13'], @bs_scale))} %"
                            td.full-input.total_p24.col-comp
                              div.percentage-badge.blue-badge
                                span.tb-badge12 = "0"
                              span.total_p24 = "0"
                              span.scale24.value-scale = @bs_scale
                              span.float-percent.percent_t24 = "0 %"
                          tr.tr-rdata
                            - @calendar_periods_bs.each do |y|
                              td.sum_input class="full-input col-#{y.id}"
                                span.text-table-concept = 'CAPTURA'
                                br
                                span.td-value25 = balance_calendar_detail_value(@company.id, y.calendar, 13, @bs_scale).to_s(:delimited)
                                span.value-scale = @bs_scale
                                span.float-percent.percent-value25 = "#{calculate_percent_of_total(balance_calendar_detail_value(@company.id, y.calendar, 13, @bs_scale), bs_capture_sum(@company.id, ['10','11','12','13'], y.calendar.id, @bs_scale))} %"
                            td.full-input.total_p25.col-comp
                              span.total_p25 = "0"
                              span.scale25.value-scale = @bs_scale
                              span.float-percent.percent_t25 = "0 %"

                          tr
                            td.concept-header style=" font-weight: 800; font-size: 18px" rowspan="2"
                              span.text-left = 'Capital Total'
                            - @calendar_periods_bs.each do |y|
                              td.concept-header class="full-input col-#{y.id}"
                                - if y.calendar.period_type == 'anual'
                                  span = 'SUM. SAT'
                                  br
                                  span = company_balance_sheet_value(@company.id, y.calendar, ['14','15','16','17'], @bs_scale).to_s(:delimited)
                                  span.value-scale = @bs_scale
                            td.concept-header.col-comp
                          tr
                            - @calendar_periods_bs.each do |y|
                              td.concept-header class="full-input col-#{y.id}"
                                span = 'SUM. CAPTURA'
                                br
                                span = bs_capture_sum(@company.id, ['14','15','16','17'], y.calendar.id, @bs_scale).to_s(:delimited)
                                span.value-scale = @bs_scale
                            td.concept-header.col-comp
                          tr.tr-rdata
                            td style="font-weight: 600" rowspan="2"
                              span.text-left = 'Capital social'
                            - @calendar_periods_bs.each_with_index do |y, y_index|
                              td.sum_input class="full-input col-#{y.id}"
                                - if y.calendar.period_type == 'anual'
                                  div class=['percentage-badge', calculate_percentage('balance_sheet', @company.id, y.calendar, 14, @bs_scale)[1]]
                                    span#comparative_table_bs class=["percent-bdg13-#{y_index}"] = "#{calculate_percentage('balance_sheet', @company.id, y.calendar, 14, @bs_scale)[0]} %"
                                  span.text-table-concept = 'SAT'
                                  br
                                  span.td-value26 = company_balance_sheet_value(@company.id, y.calendar, 14, @bs_scale).to_s(:delimited)
                                  span.value-scale = @bs_scale
                                  span.float-percent.percent-value26 = "#{calculate_percent_of_total(company_balance_sheet_value(@company.id, y.calendar, 8, @bs_scale), company_balance_sheet_value(@company.id, y.calendar, ['14','15','16','17'], @bs_scale))} %"
                            td.full-input.total_p26.col-comp
                              div.percentage-badge.blue-badge
                                span.tb-badge13 = "0"
                              span.total_p26 = "0"
                              span.scale26.value-scale = @bs_scale
                              span.float-percent.percent_t26 = "0 %"
                          tr.tr-rdata
                            - @calendar_periods_bs.each do |y|
                              td.sum_input class="full-input col-#{y.id}"
                                span.text-table-concept = 'CAPTURA'
                                br
                                span.td-value27 = balance_calendar_detail_value(@company.id, y.calendar, 14, @bs_scale).to_s(:delimited)
                                span.value-scale = @bs_scale
                                span.float-percent.percent-value27 = "#{calculate_percent_of_total(balance_calendar_detail_value(@company.id, y.calendar, 14, @bs_scale), bs_capture_sum(@company.id, ['14','15','16','17'], y.calendar.id, @bs_scale))} %"
                            td.full-input.total_p27.col-comp
                              span.total_p27 = "0"
                              span.scale27.value-scale = @bs_scale
                              span.float-percent.percent_t27 = "0 %"
                          tr.tr-rdata
                            td style="font-weight: 600" rowspan="2"
                              span.text-left = 'Utilidad/Pérdida acumulada'
                            - @calendar_periods_bs.each_with_index do |y, y_index|
                              td.sum_input class="full-input col-#{y.id}"
                                - if y.calendar.period_type == 'anual'
                                  div class=['percentage-badge', calculate_percentage('balance_sheet', @company.id, y.calendar, 15, @bs_scale)[1]]
                                    span#comparative_table_bs class=["percent-bdg14-#{y_index}"] = "#{calculate_percentage('balance_sheet', @company.id, y.calendar, 15, @bs_scale)[0]} %"
                                  span.text-table-concept = 'SAT'
                                  br
                                  span.td-value28 = company_balance_sheet_value(@company.id, y.calendar, 15, @bs_scale).to_s(:delimited)
                                  span.value-scale = @bs_scale
                                  span.float-percent.percent-value28 = "#{calculate_percent_of_total(company_balance_sheet_value(@company.id, y.calendar, 15, @bs_scale), company_balance_sheet_value(@company.id, y.calendar, ['14','15','16','17'], @bs_scale))} %"
                            td.full-input.total_p28.col-comp
                              div.percentage-badge.blue-badge
                                span.tb-badge14 = "0"
                              span.total_p28 = "0"
                              span.scale28.value-scale = @bs_scale
                              span.float-percent.percent_t28 = "0 %"
                          tr.tr-rdata
                            - @calendar_periods_bs.each do |y|
                              td.sum_input class="full-input col-#{y.id}"
                                span.text-table-concept = 'CAPTURA'
                                br
                                span.td-value29 = balance_calendar_detail_value(@company.id, y.calendar, 15, @bs_scale).to_s(:delimited)
                                span.value-scale = @bs_scale
                                span.float-percent.percent-value29 = "#{calculate_percent_of_total(balance_calendar_detail_value(@company.id, y.calendar, 15, @bs_scale), bs_capture_sum(@company.id, ['14','15','16','17'], y.calendar.id, @bs_scale))} %"
                            td.full-input.total_p29.col-comp
                              span.total_p29 = "0"
                              span.scale29.value-scale = @bs_scale
                              span.float-percent.percent_t29 = "0 %"
                          tr.tr-rdata
                            td style="font-weight: 600" rowspan="2"
                              span.text-left = 'Utilidad/Pérdida ejercicio'
                            - @calendar_periods_bs.each_with_index do |y, y_index|
                              td.sum_input class="full-input col-#{y.id}"
                                - if y.calendar.period_type == 'anual'
                                  div class=['percentage-badge', calculate_percentage('balance_sheet', @company.id, y.calendar, 16, @bs_scale)[1]]
                                    span#comparative_table_bs class=["percent-bdg15-#{y_index}"] = "#{calculate_percentage('balance_sheet', @company.id, y.calendar, 16, @bs_scale)[0]} %"
                                  span.text-table-concept = 'SAT'
                                  br
                                  span.td-value30 = company_balance_sheet_value(@company.id, y.calendar, 16, @bs_scale).to_s(:delimited)
                                  span.value-scale = @bs_scale
                                  span.float-percent.percent-value30 = "#{calculate_percent_of_total(company_balance_sheet_value(@company.id, y.calendar, 16, @bs_scale), company_balance_sheet_value(@company.id, y.calendar, ['14','15','16','17'], @bs_scale))} %"
                            td.full-input.total_p30.col-comp
                              div.percentage-badge.blue-badge
                                span.tb-badge15 = "0"
                              span.total_p30 = "0"
                              span.scale30.value-scale = @bs_scale
                              span.float-percent.percent_t30 = "0 %"
                          tr.tr-rdata
                            - @calendar_periods_bs.each do |y|
                              td.sum_input class="full-input col-#{y.id}"
                                span.text-table-concept = 'CAPTURA'
                                br
                                span.td-value31 = balance_calendar_detail_value(@company.id, y.calendar, 16, @bs_scale).to_s(:delimited)
                                span.value-scale = @bs_scale
                                span.float-percent.percent-value31 = "#{calculate_percent_of_total(balance_calendar_detail_value(@company.id, y.calendar, 16, @bs_scale), bs_capture_sum(@company.id, ['14','15','16','17'], y.calendar.id, @bs_scale))} %"
                            td.full-input.total_p31.col-comp
                              span.total_p31 = "0"
                              span.scale31.value-scale = @bs_scale
                              span.float-percent.percent_t31 = "0 %"
                          tr.tr-rdata
                            td style="font-weight: 600" rowspan="2"
                              span.text-left = 'Otras cuentas de capital'
                            - @calendar_periods_bs.each_with_index do |y, y_index|
                              td.sum_input class="full-input col-#{y.id}"
                                - if y.calendar.period_type == 'anual'
                                  div class=['percentage-badge', calculate_percentage('balance_sheet', @company.id, y.calendar, 17, @bs_scale)[1]]
                                    span#comparative_table_bs class=["percent-bdg16-#{y_index}"] = "#{calculate_percentage('balance_sheet', @company.id, y.calendar, 17, @bs_scale)[0]} %"
                                  span.text-table-concept = 'SAT'
                                  br
                                  span.td-value32 = company_balance_sheet_value(@company.id, y.calendar, 17, @bs_scale).to_s(:delimited)
                                  span.value-scale = @bs_scale
                                  span.float-percent.percent-value32 = "#{calculate_percent_of_total(company_balance_sheet_value(@company.id, y.calendar, 17, @bs_scale), company_balance_sheet_value(@company.id, y.calendar, ['14','15','16','17'], @bs_scale))} %"
                            td.full-input.total_p32.col-comp
                              div.percentage-badge.blue-badge
                                span.tb-badge16 = "0"
                              span.total_p32 = "0"
                              span.scale32.value-scale = @bs_scale
                              span.float-percent.percent_t32 = "0 %"
                          tr.tr-rdata
                            - @calendar_periods_bs.each do |y|
                              td.sum_input class="full-input col-#{y.id}"
                                span.text-table-concept = 'CAPTURA'
                                br
                                span.td-value33 = balance_calendar_detail_value(@company.id, y.calendar, 17, @bs_scale).to_s(:delimited)
                                span.value-scale = @bs_scale
                                span.float-percent.percent-value33 = "#{calculate_percent_of_total(balance_calendar_detail_value(@company.id, y.calendar, 17, @bs_scale), bs_capture_sum(@company.id, ['14','15','16','17'], y.calendar.id, @bs_scale))} %"
                            td.full-input.total_p33.col-comp
                              span.total_p33 = "0"
                              span.scale33.value-scale = @bs_scale
                              span.float-percent.percent_t33 = "0 %"
                      - else
                        .m-alert.m-alert--icon.m-alert--icon-solid.m-alert--outline.alert.alert-brand.alert-dismissible.fade.show role="alert"
                          .m-alert__icon
                            i.flaticon-exclamation-1
                            span
                          .m-alert__text
                            strong
                              | Aún no se le han asignado fechas para captura.



                      .col-md-12.mt-30
                        .btns-card.full-h
                          .subtitle-icon.d-flex.justify-content-center.align-items-center
                            i.fa.fa-comment.fa-lg.m--font-primary
                          .d-flex.flex-column.justify-content-between
                            h5.h5.subtitle = 'Comentarios'
                            .max-h-card.m-widget3
                              - if @bs_comments.length > 0
                                - @bs_comments.each do |comment|
                                  .m-widget3__item
                                    .m-widget3__header
                                      .m-widget3__info
                                        span.m-widget3__username
                                          = User.where(id: comment.user_id).try(:first).full_name
                                          /br
                                          /span.m--font-primary
                                            = "#{comment.process_status.name}"
                                        br
                                        span.m-widget3__time
                                          = comment.created_at.strftime('%d/%m/%Y,  %I:%M%p')

                                    .m-widget3__body
                                      p.m-widget3__text
                                        = comment.comment
                              - else
                                .m-widget3__item
                                  .m-widget3__body
                                    p.m-widget3__text
                                      .text-center
                                        | Aún no hay comentarios.
                            a.btn.btn-block.btn-info href="/comments/#{@company.id}/balance_sheet" target="_blank"
                              | IR A COMENTARIOS


            .tab-pane id="income_statement"
              .col-xl-12
                .m-portlet
                  .m-portlet__body
                    .m-section.mb-0
                      .m-section__content.table-responsive.text-center
                        - if @company.income_statement_finished
                          button.btn.btn-outline-primary.m-btn.m-btn--outline-2x.my-2.open-modal-cstatus data-toggle="modal" type="button" data-target="#m_modal_capture_status" data-id="#{@company.id}" data-type="income_statement_finished"
                            = "Habilitar Captura"
                        a.btn.btn-outline-primary.m-btn.m-btn--outline-2x.my-2.btn-block href="/income_statement_capture/#{@company.id}" target="_blank"
                          .fa.fa-pencil-alt
                          = "Editar Captura"
                      - if @company.company_calendar_details.where(assign_to: 'income_statement').present?
                        #wrapper
                          #checkbox_div
                            p.text-center Mostrar/Ocultar años
                            .d-flex style="justify-content: center; margin: 10px;"
                              - @calendar_periods_is.each do |y|
                                .ck-button
                                  label
                                    input onchange="hide_show_table(this.id, 'comparative_table_is');" type="checkbox" value="hide" checked="true" id="col-#{y.id}"
                                    span = y.calendar.period_name

                        table.table.table-bordered.input-focusable-table#comparative_table_is
                          tr.tr-title
                            th
                            - @calendar_periods_is.each do |y|
                              th.th-title id="col-#{y.id}_head"
                                = y.calendar.period_name
                            th id="col-comp_head_comparative_table_is"
                              = 'COMPARACIÓN (ANUAL)'
                          tr.tr-rdata
                            td style=" font-weight: 800; font-size: 18px" rowspan="2"
                              span.text-left = 'Ingresos'
                            - @calendar_periods_is.each_with_index do |y, y_index|
                              td.sum_input.sat_value class="full-input col-#{y.id}"
                                - if y.calendar.period_type == 'anual'
                                  div class=['percentage-badge', calculate_percentage('income_statement', @company.id, y.calendar, 1, @ins_scale)[1]]
                                    span#comparative_table_is class=["percent-bdg0-#{y_index}"] = "#{calculate_percentage('income_statement', @company.id, y.calendar, 1, @ins_scale)[0]} %"
                                  span.text-table-concept  = 'SAT'
                                  br
                                  span.td-value0 = company_income_stat_value(@company.id, y.calendar, 1, @ins_scale).to_s(:delimited)
                                  span.value-scale = @ins_scale

                            td.full-input.total_p0.col-comp
                              div.percentage-badge.blue-badge
                                span.tb-badge0 = "0"
                              span.total_p0 = "0"
                              span.scale0.value-scale = @bs_scale
                          tr.tr-rdata
                            - @calendar_periods_is.each do |y|
                              td.sum_input class="full-input col-#{y.id}"
                                span.text-table-concept = 'CAPTURA'
                                br
                                span.td-value1 = income_calendar_detail_value(@company.id, y.calendar, 1, @ins_scale).to_s(:delimited)
                                span.value-scale = @ins_scale

                            td.full-input.total_p1.col-comp
                              span.total_p1 = "0"
                              span.scale1.value-scale = @bs_scale
                          tr.tr-rdata
                            td style=" font-weight: 800; font-size: 18px" rowspan="2"
                              span.text-left = 'Costo de ventas'
                            - @calendar_periods_is.each_with_index do |y, y_index|
                              td.sum_input class="full-input col-#{y.id}"
                                - if y.calendar.period_type == 'anual'
                                  div class=['percentage-badge', calculate_percentage('income_statement', @company.id, y.calendar, 2, @ins_scale)[1]]
                                    span#comparative_table_is class=["percent-bdg1-#{y_index}"] = "#{calculate_percentage('income_statement', @company.id, y.calendar, 2, @ins_scale)[0]} %"
                                  span.text-table-concept  = 'SAT'
                                  br
                                  span.td-value2 = company_income_stat_value(@company.id, y.calendar, 2, @ins_scale).to_s(:delimited)
                                  span.value-scale = @ins_scale

                            td.full-input.total_p2.col-comp
                              div.percentage-badge.blue-badge
                                span.tb-badge1 = "0"
                              span.total_p2 = "0"
                              span.scale2.value-scale = @ins_scale
                          tr.tr-rdata
                            - @calendar_periods_is.each do |y|
                              td.sum_input class="full-input col-#{y.id}"
                                span.text-table-concept = 'CAPTURA'
                                br
                                span.td-value3 = income_calendar_detail_value(@company.id, y.calendar, 2, @ins_scale).to_s(:delimited)
                                span.value-scale = @bs_scale

                            td.full-input.total_p3.col-comp
                              span.total_p3 = "0"
                              span.scale3.value-scale = @ins_scale
                          tr.tr-rdata
                            td style=" font-weight: 800; font-size: 18px" rowspan="2"
                              span.text-left = 'Utilidad Bruta'
                            - @calendar_periods_is.each_with_index do |y, y_index|
                              td.sum_input class="full-input col-#{y.id}"
                                - if y.calendar.period_type == 'anual'
                                  div class=['percentage-badge', calculate_percentage('income_statement', @company.id, y.calendar, 3, @ins_scale)[1]]
                                    span#comparative_table_is class=["percent-bdg2-#{y_index}"] = "#{calculate_percentage('income_statement', @company.id, y.calendar, 2, @ins_scale)[0]} %"
                                  span.text-table-concept  = 'SAT'
                                  br
                                  span.td-value4  = company_income_stat_value(@company.id, y.calendar, 3, @ins_scale).to_s(:delimited)
                                  span.value-scale = @ins_scale

                            td.full-input.total_p4.col-comp
                              div.percentage-badge.blue-badge
                                span.tb-badge2 = "0"
                              span.total_p4 = "0"
                              span.scale4.value-scale = @ins_scale
                          tr.tr-rdata
                            - @calendar_periods_is.each do |y|
                              td.sum_input class="full-input col-#{y.id}"
                                span.text-table-concept = 'CAPTURA'
                                br
                                span.td-value5 = income_calendar_detail_value(@company.id, y.calendar, 3, @ins_scale).to_s(:delimited)
                                span.value-scale = @ins_scale

                            td.full-input.total_p5.col-comp
                              span.total_p5 = "0"
                              span.scale5.value-scale = @ins_scale
                          tr.tr-rdata
                            td style=" font-weight: 800; font-size: 18px" rowspan="2"
                              span.text-left = 'Gastos de operación'
                            - @calendar_periods_is.each_with_index do |y, y_index|
                              td.sum_input class="full-input col-#{y.id}"
                                - if y.calendar.period_type == 'anual'
                                  div class=['percentage-badge', calculate_percentage('income_statement', @company.id, y.calendar, 4, @ins_scale)[1]]
                                    span#comparative_table_is class=["percent-bdg3-#{y_index}"] = "#{calculate_percentage('income_statement', @company.id, y.calendar, 4, @ins_scale)[0]} %"
                                  span.text-table-concept  = 'SAT'
                                  br
                                  span.td-value6 = company_income_stat_value(@company.id, y.calendar, 4, @ins_scale).to_s(:delimited)
                                  span.value-scale = @ins_scale

                            td.full-input.total_p6.col-comp
                              div.percentage-badge.blue-badge
                                span.tb-badge3 = "0"
                              span.total_p6 = "0"
                              span.scale6.value-scale = @ins_scale
                          tr.tr-rdata
                            - @calendar_periods_is.each do |y|
                              td.sum_input class="full-input col-#{y.id}"
                                span.text-table-concept = 'CAPTURA'
                                br
                                span.td-value7 = income_calendar_detail_value(@company.id, y.calendar, 4, @ins_scale).to_s(:delimited)
                                span.value-scale = @ins_scale

                            td.full-input.total_p7.col-comp
                              span.total_p7 = "0"
                              span.scale7.value-scale = @ins_scale
                          tr.tr-rdata
                            td style=" font-weight: 800; font-size: 18px" rowspan="2"
                              span.text-left = 'Utilidad de operación'
                            - @calendar_periods_is.each_with_index do |y, y_index|
                              td.sum_input class="full-input col-#{y.id}"
                                - if y.calendar.period_type == 'anual'
                                  div class=['percentage-badge', calculate_percentage('income_statement', @company.id, y.calendar, 5, @ins_scale)[1]]
                                    span#comparative_table_is class=["percent-bdg4-#{y_index}"] = "#{calculate_percentage('income_statement', @company.id, y.calendar, 5, @ins_scale)[0]} %"
                                  span.text-table-concept  = 'SAT'
                                  br
                                  span.td-value8 = company_income_stat_value(@company.id, y.calendar, 5, @ins_scale).to_s(:delimited)
                                  span.value-scale = @ins_scale

                            td.full-input.total_p8.col-comp
                              div.percentage-badge.blue-badge
                                span.tb-badge4 = "0"
                              span.total_p8 = "0"
                              span.scale8.value-scale = @ins_scale
                          tr.tr-rdata
                            - @calendar_periods_is.each do |y|
                              td.sum_input class="full-input col-#{y.id}"
                                span.text-table-concept = 'CAPTURA'
                                br
                                span.td-value9 = income_calendar_detail_value(@company.id, y.calendar, 5, @ins_scale).to_s(:delimited)
                                span.value-scale = @ins_scale

                            td.full-input.total_p9.col-comp
                              span.total_p9 = "0"
                              span.scale9.value-scale = @ins_scale
                          tr.tr-rdata
                            td style=" font-weight: 800; font-size: 18px" rowspan="2"
                              span.text-left = 'Resultado integral de financiamiento'
                            - @calendar_periods_is.each_with_index do |y, y_index|
                              td.sum_input class="full-input col-#{y.id}"
                                - if y.calendar.period_type == 'anual'
                                  div class=['percentage-badge', calculate_percentage('income_statement', @company.id, y.calendar, 6, @ins_scale)[1]]
                                    span#comparative_table_is class=["percent-bdg5-#{y_index}"] = "#{calculate_percentage('income_statement', @company.id, y.calendar, 6, @ins_scale)[0]} %"
                                  span.text-table-concept  = 'SAT'
                                  br
                                  span.td-value10  = company_income_stat_value(@company.id, y.calendar, 6, @ins_scale).to_s(:delimited)
                                  span.value-scale = @ins_scale

                            td.full-input.total_p10.col-comp
                              div.percentage-badge.blue-badge
                                span.tb-badge5 = "0"
                              span.total_p10 = "0"
                              span.scale10.value-scale = @ins_scale
                          tr.tr-rdata
                            - @calendar_periods_is.each do |y|
                              td.sum_input class="full-input col-#{y.id}"
                                span.text-table-concept = 'CAPTURA'
                                br
                                span.td-value11 = income_calendar_detail_value(@company.id, y.calendar, 6, @ins_scale).to_s(:delimited)
                                span.value-scale = @ins_scale

                            td.full-input.total_p11.col-comp
                              span.total_p11 = "0"
                              span.scale11.value-scale = @ins_scale
                          tr.tr-rdata
                            td style=" font-weight: 800; font-size: 18px" rowspan="2"
                              span.text-left = 'Gasto financiero'
                            - @calendar_periods_is.each_with_index do |y, y_index|
                              td.sum_input class="full-input col-#{y.id}"
                                - if y.calendar.period_type == 'anual'
                                  div class=['percentage-badge', calculate_percentage('income_statement', @company.id, y.calendar, 7, @ins_scale)[1]]
                                    span#comparative_table_is class=["percent-bdg6-#{y_index}"] = "#{calculate_percentage('income_statement', @company.id, y.calendar, 7, @ins_scale)[0]} %"
                                  span.text-table-concept  = 'SAT'
                                  br
                                  span.td-value12  = company_income_stat_value(@company.id, y.calendar, 7, @ins_scale).to_s(:delimited)
                                  span.value-scale = @ins_scale

                            td.full-input.total_p12.col-comp
                              div.percentage-badge.blue-badge
                                span.tb-badge6 = "0"
                              span.total_p12 = "0"
                              span.scale12.value-scale = @ins_scale
                          tr.tr-rdata
                            - @calendar_periods_is.each do |y|
                              td.sum_input class="full-input col-#{y.id}"
                                span.text-table-concept = 'CAPTURA'
                                br
                                span.td-value13 = income_calendar_detail_value(@company.id, y.calendar, 7, @ins_scale).to_s(:delimited)
                                span.value-scale = @ins_scale

                            td.full-input.total_p13.col-comp
                              span.total_p13 = "0"
                              span.scale13.value-scale = @ins_scale
                          tr.tr-rdata
                            td style=" font-weight: 800; font-size: 18px" rowspan="2"
                              span.text-left = 'Utilidad o pérdida cambiaria'
                            - @calendar_periods_is.each_with_index do |y, y_index|
                              td.sum_input class="full-input col-#{y.id}"
                                - if y.calendar.period_type == 'anual'
                                  div class=['percentage-badge', calculate_percentage('income_statement', @company.id, y.calendar, 8, @ins_scale)[1]]
                                    span#comparative_table_is class=["percent-bdg7-#{y_index}"] = "#{calculate_percentage('income_statement', @company.id, y.calendar, 8, @ins_scale)[0]} %"
                                  span.text-table-concept  = 'SAT'
                                  br
                                  span.td-value14  = company_income_stat_value(@company.id, y.calendar, 8, @ins_scale).to_s(:delimited)
                                  span.value-scale = @ins_scale

                            td.full-input.total_p14.col-comp
                              div.percentage-badge.blue-badge
                                span.tb-badge7 = "0"
                              span.total_p14 = "0"
                              span.scale14.value-scale = @ins_scale
                          tr.tr-rdata
                            - @calendar_periods_is.each do |y|
                              td.sum_input class="full-input col-#{y.id}"
                                span.text-table-concept = 'CAPTURA'
                                br
                                span.td-value15 = income_calendar_detail_value(@company.id, y.calendar, 8, @ins_scale).to_s(:delimited)
                                span.value-scale = @ins_scale

                            td.full-input.total_p15.col-comp
                              span.total_p15 = "0"
                              span.scale15.value-scale = @ins_scale
                          tr.tr-rdata
                            td style=" font-weight: 800; font-size: 18px" rowspan="2"
                              span.text-left = 'Otros gastos/ingresos'
                            - @calendar_periods_is.each_with_index do |y, y_index|
                              td.sum_input class="full-input col-#{y.id}"
                                - if y.calendar.period_type == 'anual'
                                  div class=['percentage-badge', calculate_percentage('income_statement', @company.id, y.calendar, 9, @ins_scale)[1]]
                                    span#comparative_table_is class=["percent-bdg8-#{y_index}"] = "#{calculate_percentage('income_statement', @company.id, y.calendar, 9, @ins_scale)[0]} %"
                                  span.text-table-concept  = 'SAT'
                                  br
                                  span.td-value16  = company_income_stat_value(@company.id, y.calendar, 9, @ins_scale).to_s(:delimited)
                                  span.value-scale = @ins_scale

                            td.full-input.total_p16.col-comp
                              div.percentage-badge.blue-badge
                                span.tb-badge8 = "0"
                              span.total_p16 = "0"
                              span.scale16.value-scale = @ins_scale
                          tr.tr-rdata
                            - @calendar_periods_is.each do |y|
                              td.sum_input class="full-input col-#{y.id}"
                                span.text-table-concept = 'CAPTURA'
                                br
                                span.td-value17 = income_calendar_detail_value(@company.id, y.calendar, 9, @ins_scale).to_s(:delimited)
                                span.value-scale = @ins_scale

                            td.full-input.total_p17.col-comp
                              span.total_p17 = "0"
                              span.scale17.value-scale = @ins_scale
                          tr.tr-rdata
                            td style=" font-weight: 800; font-size: 18px" rowspan="2"
                              span.text-left = 'Utilidad antes de impuestos'
                            - @calendar_periods_is.each_with_index do |y, y_index|
                              td.sum_input class="full-input col-#{y.id}"
                                - if y.calendar.period_type == 'anual'
                                  div class=['percentage-badge', calculate_percentage('income_statement', @company.id, y.calendar, 10, @ins_scale)[1]]
                                    span#comparative_table_is class=["percent-bdg9-#{y_index}"] = "#{calculate_percentage('income_statement', @company.id, y.calendar, 10, @ins_scale)[0]} %"
                                  span.text-table-concept  = 'SAT'
                                  br
                                  span.td-value18  = company_income_stat_value(@company.id, y.calendar, 10, @ins_scale).to_s(:delimited)
                                  span.value-scale = @ins_scale

                            td.full-input.total_p18.col-comp
                              div.percentage-badge.blue-badge
                                span.tb-badge9 = "0"
                              span.total_p18 = "0"
                              span.scale18.value-scale = @bs_scale
                          tr.tr-rdata
                            - @calendar_periods_is.each do |y|
                              td.sum_input class="full-input col-#{y.id}"
                                span.text-table-concept = 'CAPTURA'
                                br
                                span.td-value19 = income_calendar_detail_value(@company.id, y.calendar, 10, @ins_scale).to_s(:delimited)
                                span.value-scale = @ins_scale

                            td.full-input.total_p19.col-comp
                              span.total_p19 = "0"
                              span.scale19.value-scale = @ins_scale
                          tr.tr-rdata
                            td style=" font-weight: 800; font-size: 18px" rowspan="2"
                              span.text-left = 'ISR'
                            - @calendar_periods_is.each_with_index do |y, y_index|
                              td.sum_input class="full-input col-#{y.id}"
                                - if y.calendar.period_type == 'anual'
                                  div class=['percentage-badge', calculate_percentage('income_statement', @company.id, y.calendar, 11, @ins_scale)[1]]
                                    span#comparative_table_is class=["percent-bdg10-#{y_index}"] = "#{calculate_percentage('income_statement', @company.id, y.calendar, 11, @ins_scale)[0]} %"
                                  span.text-table-concept  = 'SAT'
                                  br
                                  span.td-value20  = company_income_stat_value(@company.id, y.calendar, 11, @ins_scale).to_s(:delimited)
                                  span.value-scale = @ins_scale

                            td.full-input.total_p20.col-comp
                              div.percentage-badge.blue-badge
                                span.tb-badge10 = "0"
                              span.total_p20 = "0"
                              span.scale20.value-scale = @ins_scale
                          tr.tr-rdata
                            - @calendar_periods_is.each do |y|
                              td.sum_input class="full-input col-#{y.id}"
                                span.text-table-concept = 'CAPTURA'
                                br
                                span.td-value21 = income_calendar_detail_value(@company.id, y.calendar, 11, @ins_scale).to_s(:delimited)
                                span.value-scale = @ins_scale

                            td.full-input.total_p21.col-comp
                              span.total_p21 = "0"
                              span.scale21.value-scale = @ins_scale
                          tr.tr-rdata
                            td style=" font-weight: 800; font-size: 18px" rowspan="2"
                              span.text-left = 'PTU'
                            - @calendar_periods_is.each_with_index do |y, y_index|
                              td.sum_input class="full-input col-#{y.id}"
                                - if y.calendar.period_type == 'anual'
                                  div class=['percentage-badge', calculate_percentage('income_statement', @company.id, y.calendar, 12, @ins_scale)[1]]
                                    span#comparative_table_is class=["percent-bdg11-#{y_index}"] = "#{calculate_percentage('income_statement', @company.id, y.calendar, 12, @ins_scale)[0]} %"
                                  span.text-table-concept  = 'SAT'
                                  br
                                  span.td-value22  = company_income_stat_value(@company.id, y.calendar, 12, @ins_scale).to_s(:delimited)
                                  span.value-scale = @ins_scale

                            td.full-input.total_p22.col-comp
                              div.percentage-badge.blue-badge
                                span.tb-badge11 = "0"
                              span.total_p22 = "0"
                              span.scale22.value-scale = @ins_scale
                          tr.tr-rdata
                            - @calendar_periods_is.each do |y|
                              td.sum_input class="full-input col-#{y.id}"
                                span.text-table-concept = 'CAPTURA'
                                br
                                span.td-value23 = income_calendar_detail_value(@company.id, y.calendar, 12, @ins_scale).to_s(:delimited)
                                span.value-scale = @ins_scale

                            td.full-input.total_p23.col-comp
                              span.total_p23 = "0"
                              span.scale23.value-scale = @ins_scale
                          tr.tr-rdata
                            td style=" font-weight: 800; font-size: 18px" rowspan="2"
                              span.text-left = 'Participación subsidiarios'
                            - @calendar_periods_is.each_with_index do |y, y_index|
                              td.sum_input class="full-input col-#{y.id}"
                                - if y.calendar.period_type == 'anual'
                                  div class=['percentage-badge', calculate_percentage('income_statement', @company.id, y.calendar, 13, @ins_scale)[1]]
                                    span#comparative_table_is class=["percent-bdg12-#{y_index}"] = "#{calculate_percentage('income_statement', @company.id, y.calendar, 13, @ins_scale)[0]} %"
                                  span.text-table-concept  = 'SAT'
                                  br
                                  span.td-value24  = company_income_stat_value(@company.id, y.calendar, 13, @ins_scale).to_s(:delimited)
                                  span.value-scale = @ins_scale

                            td.full-input.total_p24.col-comp
                              div.percentage-badge.blue-badge
                                span.tb-badge12 = "0"
                              span.total_p24 = "0"
                              span.scale24.value-scale = @ins_scale
                          tr.tr-rdata
                            - @calendar_periods_is.each do |y|
                              td.sum_input class="full-input col-#{y.id}"
                                span.text-table-concept = 'CAPTURA'
                                br
                                span.td-value25 = income_calendar_detail_value(@company.id, y.calendar, 13, @ins_scale).to_s(:delimited)
                                span.value-scale = @ins_scale

                            td.full-input.total_p25.col-comp
                              span.total_p25 = "0"
                              span.scale25.value-scale = @ins_scale
                          tr.tr-rdata
                            td style=" font-weight: 800; font-size: 18px" rowspan="2"
                              // 14: UTILIDAD NETA
                              span.text-left = 'Utilidad neta'
                            - @calendar_periods_is.each_with_index do |y, y_index|
                              td.sum_input class="full-input col-#{y.id}"
                                - if y.calendar.period_type == 'anual'
                                  div class=['percentage-badge', calculate_percentage('income_statement', @company.id, y.calendar, 14, @ins_scale)[1]]
                                    span#comparative_table_is class=["percent-bdg13-#{y_index}"] = "#{calculate_percentage('income_statement', @company.id, y.calendar, 14, @ins_scale)[0]} %"
                                  span.text-table-concept  = 'SAT'
                                  br
                                  span.td-value26  = company_income_stat_value(@company.id, y.calendar, 14, @ins_scale).to_s(:delimited)
                                  span.value-scale = @ins_scale

                            td.full-input.total_p26.col-comp
                              div.percentage-badge.blue-badge
                                span.tb-badge13 = "0"
                              span.total_p26 = "0"
                              span.scale26.value-scale = @ins_scale
                          tr.tr-rdata
                            - @calendar_periods_is.each do |y|
                              td.sum_input class="full-input col-#{y.id}"
                                span.text-table-concept = 'CAPTURA'
                                br
                                span.td-value27 = income_calendar_detail_value(@company.id, y.calendar, 14, @ins_scale).to_s(:delimited)
                                span.value-scale = @ins_scale

                            td.full-input.total_p27.col-comp
                              span.total_p27 = "0"
                              span.scale27.value-scale = @ins_scale
                      - else
                        .m-alert.m-alert--icon.m-alert--icon-solid.m-alert--outline.alert.alert-brand.alert-dismissible.fade.show role="alert"
                          .m-alert__icon
                            i.flaticon-exclamation-1
                            span
                          .m-alert__text
                            strong
                              | Aún no se le han asignado fechas para captura.




                      .col-md-12.mt-30
                        .btns-card.full-h
                          .subtitle-icon.d-flex.justify-content-center.align-items-center
                            i.fa.fa-comment.fa-lg.m--font-primary
                          .d-flex.flex-column.justify-content-between
                            h5.h5.subtitle = 'Comentarios'
                            .max-h-card.m-widget3
                              - if @is_comments.length > 0
                                - @is_comments.each do |comment|
                                  .m-widget3__item
                                    .m-widget3__header
                                      .m-widget3__info
                                        span.m-widget3__username
                                          = User.where(id: comment.user_id).try(:first).full_name
                                          /br
                                          /span.m--font-primary
                                            = "#{comment.process_status.name}"
                                        br
                                        span.m-widget3__time
                                          = comment.created_at.strftime('%d/%m/%Y,  %I:%M%p')

                                    .m-widget3__body
                                      p.m-widget3__text
                                        = comment.comment
                              - else
                                .m-widget3__item
                                  .m-widget3__body
                                    p.m-widget3__text
                                      .text-center
                                        | Aún no hay comentarios.
                            a.btn.btn-block.btn-info href="/comments/#{@company.id}/income_statement" target="_blank"
                              | IR A COMENTARIOS

            .tab-pane id="financial_reasons"
              .col-xl-12
                .m-portlet
                  .m-portlet__body
                    .m-section.mb-0
                      .m-section__content.table-responsive.text-center
                        a.btn.btn-outline-primary.m-btn.m-btn--outline-2x.my-2.open-modal-cstatus href="/generate_financial_reasons/#{@company.id}"
                          = "Generar razónes financieras"

                      - if @company.company_calendar_details.where(assign_to: 'income_statement').present? and FReasonsCompany.where(company_id: @company.id).length > 0
                        = render 'financial_reasons'
                      - else
                        .m-alert.m-alert--icon.m-alert--icon-solid.m-alert--outline.alert.alert-brand.alert-dismissible.fade.show role="alert"
                          .m-alert__icon
                            i.flaticon-exclamation-1
                            span
                          .m-alert__text
                            strong
                              | Aún no se han generado las razónes financieras.

                      .col-md-12.mt-30
                        .btns-card.full-h
                          .subtitle-icon.d-flex.justify-content-center.align-items-center
                            i.fa.fa-comment.fa-lg.m--font-primary
                          .d-flex.flex-column.justify-content-between
                            h5.h5.subtitle = 'Comentarios'
                            .max-h-card.m-widget3
                              - if @fr_comments.length > 0
                                - @fr_comments.each do |comment|
                                  .m-widget3__item
                                    .m-widget3__header
                                      .m-widget3__info
                                        span.m-widget3__username
                                          = User.where(id: comment.user_id).try(:first).full_name
                                          /br
                                          /span.m--font-primary
                                            = "#{comment.process_status.name}"
                                        br
                                        span.m-widget3__time
                                          = comment.created_at.strftime('%d/%m/%Y,  %I:%M%p')

                                    .m-widget3__body
                                      p.m-widget3__text
                                        = comment.comment
                              - else
                                .m-widget3__item
                                  .m-widget3__body
                                    p.m-widget3__text
                                      .text-center
                                        | Aún no hay comentarios.
                            a.btn.btn-block.btn-info href="/comments/#{@company.id}/financial_reasons" target="_blank"
                              | IR A COMENTARIOS


            .tab-pane id="credit_bureau"
              .col-xl-12
                .m-portlet
                  .m-portlet__head-tools
                    .m-portlet__nav
                      .m-portlet__nav-item
                        .col-2.pl-0 style="text-align:right;"
                          = link_to company_details_path(@company.id, format: :pdf), class: 'btn btn-outline-primary m-btn m-btn--outline-2x btn-block my-2' do
                            = "Generar PDF"
                  .m-portlet__body
                    .m-section.mb-0
                      - if !@credit_bureau.present?
                        .m-section__content
                          .no-results

                      - else
                        .m-section__sub
                          .row.m-section__sub style="display: flex"
                            .col-6.pl-0

                            .col-6.per-page-container
                        .m-section__content
                          - if @credit_bureau.present? and @company.try(:client_type).eql?('PF')
                            .m-demo data-code-html="true" data-code-js="false" data-code-preview="true"
                            .m-demo__preview
                              h3.m-portlet__head-text
                                | SCORE
                            .m-demo data-code-html="true" data-code-js="false" data-code-preview="true"
                              .m-demo__preview
                                .d-flex.flex-column.justify-content-center
                                  .gauge-wrapper
                                    .gauge.four.rischio style="--degres: #{calculate_degrees(@score)}deg;"
                                      .slice-colors
                                        .st.slice-item
                                        .st.slice-item
                                        .st.slice-item
                                        .st.slice-item
                                      .needle
                                      .gauge-center
                                        .number
                                          = @score
                                        .status-face
                                        /= image_tag calculate_face(@score)

                                  .d-inline-flex.justify-content-center
                                    .d-flex.flex-column.justify-content-between.align-items-center.status-container
                                      span.text-center
                                        strong  = 'BAJA, MENOR A 550 PUNTOS'
                                      = image_tag 'face-bad.png'
                                    .d-flex.flex-column.justify-content-between.align-items-center.status-container
                                      span.text-center
                                        strong = 'REGULAR, 551-650 PUNTOS'
                                      = image_tag 'face-med.png'
                                    .d-flex.flex-column.justify-content-between.align-items-center.status-container
                                      span.text-center
                                        strong = 'BUENA 651- 750 PUNTOS'
                                      = image_tag 'face-nice.png'
                                    .d-flex.flex-column.justify-content-between.align-items-center.status-container
                                      span.text-center
                                        strong = 'EXCELENTE MÁS DE 751 PUNTOS'
                                      = image_tag 'face-good.png'
                            .m-demo data-code-html="true" data-code-js="false" data-code-preview="true"
                              .m-demo__preview
                                h3.m-portlet__head-text
                                  | Datos Generales
                                .m-stack.m-stack--ver.m-stack--general.m-stack--demo
                                  - if @credit_bureau.present?

                                    - if @report_result['response'].present?
                                      .m-stack__item.header-info-company.m-stack__item--left.m-stack__item--middle
                                        strong
                                          | Nombre
                                      .m-stack__item.m-stack__item--left.body-info-company.m-stack__item--middle
                                        = @report_result['response']['return']['Personas']['Persona'][0]['Nombre']['PrimerNombre'] + ' ' + @report_result['response']['return']['Personas']['Persona'][0]['Nombre']['ApellidoPaterno'] + ' ' + @report_result['response']['return']['Personas']['Persona'][0]['Nombre']['ApellidoMaterno']
                                      .m-stack__item.header-info-company.m-stack__item--left.m-stack__item--middle
                                        strong
                                          | R.F.C
                                      .m-stack__item.m-stack__item--left.body-info-company.m-stack__item--middle
                                        = @report_result['response']['return']['Personas']['Persona'][0]['Nombre']['RFC']
                                      .m-stack__item.header-info-company.m-stack__item--left.m-stack__item--middle
                                        strong
                                          | Fecha de nacimiento
                                      .m-stack__item.m-stack__item--left.body-info-company.m-stack__item--middle
                                        = get_pm_birthdate @report_result['response']['return']['Personas']['Persona'][0]['Nombre']['FechaNacimiento']
                                    - else
                                      .m-alert.m-alert--icon.m-alert--icon-solid.m-alert--outline.alert.alert-brand.alert-dismissible.fade.show role="alert"
                                        .m-alert__icon
                                          i.flaticon-exclamation-1
                                          span
                                        .m-alert__text
                                          strong
                                            | Aún no se encuentran datos generales.
                                  - else
                                    .m-alert.m-alert--icon.m-alert--icon-solid.m-alert--outline.alert.alert-brand.alert-dismissible.fade.show role="alert"
                                      .m-alert__icon
                                        i.flaticon-exclamation-1
                                        span
                                      .m-alert__text
                                        strong
                                          | Aún no se encuentran datos generales.
                            .m-demo data-code-html="true" data-code-js="false" data-code-preview="true"
                              .m-demo__preview
                                h3.m-portlet__head-text
                                  | Resumen de Créditos (M.N.)
                                - if @credit_bureau.bureau_report.present?
                                  - if @report_result['response'].present?
                                    .m-stack.m-stack--ver.m-stack--general.m-stack--demo
                                      .m-section
                                        .m-section__content
                                          table.table style="display: block;overflow-x: auto;"
                                            thead.thead-default
                                              tr
                                                th
                                                  | MOP
                                                th
                                                  | Cuentas Abiertas
                                                th
                                                  | Limite Abiertas
                                                th
                                                  | Maximo Abiertas
                                                th
                                                  | Saldo Actual Abiertas
                                                th
                                                  | Saldo Vencido Abiertas
                                                th
                                                  | Pago a Realizar
                                                th
                                                  | Cuentas Cerradas
                                                th
                                                  | Limite Cerradas
                                                th
                                                  | Maximo Cerradas
                                                th
                                                  | Saldo Actual Cerradas
                                                th
                                                  | Monto Cerradas
                                            tbody
                                              - get_ur_credits(@report_result['response']['return']['Personas']['Persona'][0]['Cuentas']['Cuenta']).each do |credit|
                                                tr
                                                  td
                                                    = credit[:mop]
                                                  td
                                                    = credit[:cuentas_abiertas]
                                                  td
                                                    = number_to_currency credit[:limite_abiertas]
                                                  td
                                                    = number_to_currency credit[:maximo_abiertas]
                                                  td
                                                    = number_to_currency credit[:saldo_actual]
                                                  td
                                                    = number_to_currency credit[:saldo_vencido]
                                                  td
                                                    = number_to_currency credit[:pago_realizar]
                                                  td
                                                    = credit[:cuentas_cerradas]
                                                  td
                                                    = number_to_currency credit[:limite_cerradas]
                                                  td
                                                    = number_to_currency credit[:maximo_cerradas]
                                                  td
                                                    = number_to_currency credit[:saldo_cerradas]
                                                  td
                                                    = number_to_currency credit[:monto_cerradas]

                            .m-demo data-code-html="true" data-code-js="false" data-code-preview="true"
                              .m-demo__preview
                                h3.m-portlet__head-text
                                  | Domicilios registrados
                                - if @credit_bureau.present?
                                  - if @report_result['response'].present?
                                    - @report_result['response']['return']['Personas']['Persona'][0]['Domicilios']['Domicilio'].each do |address|
                                      .m-stack.m-stack--ver.m-stack--general.m-stack--demo
                                        .m-stack__item.header-info-company.m-stack__item--left.m-stack__item--middle
                                          strong
                                            | Calle y número
                                        .m-stack__item.m-stack__item--left.body-info-company.m-stack__item--middle
                                          = address['Direccion1']
                                        .m-stack__item.header-info-company.m-stack__item--left.m-stack__item--middle
                                          strong
                                            | Colonia
                                        .m-stack__item.m-stack__item--left.body-info-company.m-stack__item--middle
                                          = address['ColoniaPoblacion']
                                        .m-stack__item.header-info-company.m-stack__item--left.m-stack__item--middle
                                          strong
                                            | Del / Mpio
                                        .m-stack__item.m-stack__item--left.body-info-company.m-stack__item--middle
                                          = address['DelegacionMunicipio']
                                      .m-stack.m-stack--ver.m-stack--general.m-stack--demo
                                        .m-stack__item.header-info-company.m-stack__item--left.m-stack__item--middle
                                          strong
                                            | Estado
                                        .m-stack__item.m-stack__item--left.body-info-company.m-stack__item--middle
                                          = address['Estado']
                                        .m-stack__item.header-info-company.m-stack__item--left.m-stack__item--middle
                                          strong
                                            | C.P
                                        .m-stack__item.m-stack__item--left.body-info-company.m-stack__item--middle
                                          = address['CP']
                                        .m-stack__item.header-info-company.m-stack__item--left.m-stack__item--middle
                                          strong
                                            | Teléfono
                                        .m-stack__item.m-stack__item--left.body-info-company.m-stack__item--middle
                                          = address['NumeroTelefono']
                                      br
                                  - else
                                    .m-stack.m-stack--ver.m-stack--general.m-stack--demo
                                      .m-alert.m-alert--icon.m-alert--icon-solid.m-alert--outline.alert.alert-brand.alert-dismissible.fade.show role="alert"
                                        .m-alert__icon
                                          i.flaticon-exclamation-1
                                          span
                                        .m-alert__text
                                          strong
                                            | Aún no se encuentran domicilios registrados.
                                - else
                                  .m-stack.m-stack--ver.m-stack--general.m-stack--demo
                                    .m-alert.m-alert--icon.m-alert--icon-solid.m-alert--outline.alert.alert-brand.alert-dismissible.fade.show role="alert"
                                      .m-alert__icon
                                        i.flaticon-exclamation-1
                                        span
                                      .m-alert__text
                                        strong
                                          | Aún no se encuentran domicilios registrados.

                            .m-demo data-code-html="true" data-code-js="false" data-code-preview="true"
                              .m-demo__preview
                                h3.m-portlet__head-text
                                  | Domicilio(s) de empleo(s) registrado(s)
                                - if @credit_bureau.present?
                                  - if @report_result['response'].present?
                                    - @report_result['response']['return']['Personas']['Persona'][0]['Empleos']['Empleo'].each do |job|
                                      .m-stack.m-stack--ver.m-stack--general.m-stack--demo
                                        .m-stack__item.header-info-company.m-stack__item--left.m-stack__item--middle
                                          strong
                                            | Compañía
                                        .m-stack__item.m-stack__item--left.body-info-company.m-stack__item--middle
                                          = job['NombreEmpresa']
                                        .m-stack__item.header-info-company.m-stack__item--left.m-stack__item--middle
                                          strong
                                            | Puesto
                                        .m-stack__item.m-stack__item--left.body-info-company.m-stack__item--middle
                                          = job['Cargo']
                                        .m-stack__item.header-info-company.m-stack__item--left.m-stack__item--middle
                                          strong
                                            | País
                                        .m-stack__item.m-stack__item--left.body-info-company.m-stack__item--middle
                                          = job['CodPais']
                                      .m-stack.m-stack--ver.m-stack--general.m-stack--demo
                                        .m-stack__item.header-info-company.m-stack__item--left.m-stack__item--middle
                                          strong
                                            | Calle y número
                                        .m-stack__item.m-stack__item--left.body-info-company.m-stack__item--middle
                                          = job['Direccion1']
                                        .m-stack__item.header-info-company.m-stack__item--left.m-stack__item--middle
                                          strong
                                            | Telefono
                                        .m-stack__item.m-stack__item--left.body-info-company.m-stack__item--middle
                                          = job['NumeroTelefono']
                                        .m-stack__item.header-info-company.m-stack__item--left.m-stack__item--middle
                                          strong
                                            | Fecha de contratación
                                        .m-stack__item.m-stack__item--left.body-info-company.m-stack__item--middle
                                          =  get_pm_birthdate job['FechaContratacion']

                                      br
                                  - else
                                    .m-stack.m-stack--ver.m-stack--general.m-stack--demo
                                      .m-alert.m-alert--icon.m-alert--icon-solid.m-alert--outline.alert.alert-brand.alert-dismissible.fade.show role="alert"
                                        .m-alert__icon
                                          i.flaticon-exclamation-1
                                          span
                                        .m-alert__text
                                          strong
                                            | Aún no se encuentran Domicilio(s) de empleo(s) registrado(s).
                                - else
                                  .m-stack.m-stack--ver.m-stack--general.m-stack--demo
                                    .m-alert.m-alert--icon.m-alert--icon-solid.m-alert--outline.alert.alert-brand.alert-dismissible.fade.show role="alert"
                                      .m-alert__icon
                                        i.flaticon-exclamation-1
                                        span
                                      .m-alert__text
                                        strong
                                          | Aún no se encuentran Domicilio(s) de empleo(s) registrado(s).


                            .m-demo data-code-html="true" data-code-js="false" data-code-preview="true"
                              .m-demo__preview
                                h3.m-portlet__head-text
                                  | Cuentas
                                - if @credit_bureau.present?
                                  - if @report_result['response'].present?
                                    - @report_result['response']['return']['Personas']['Persona'][0]['Cuentas']['Cuenta'].each do |account|
                                      .m-stack.m-stack--ver.m-stack--general.m-stack--demo
                                        .m-stack__item.header-info-company.m-stack__item--left.m-stack__item--middle
                                          strong
                                            | Nombre del Otorgante
                                        .m-stack__item.m-stack__item--left.body-info-company.m-stack__item--middle
                                          = account['NombreOtorgante']
                                        .m-stack__item.header-info-company.m-stack__item--left.m-stack__item--middle
                                          strong
                                            | Monto a pagar
                                        .m-stack__item.m-stack__item--left.body-info-company.m-stack__item--middle
                                          = number_to_currency account['MontoPagar']
                                        .m-stack__item.header-info-company.m-stack__item--left.m-stack__item--middle
                                          strong
                                            | Tipo de cuenta
                                        .m-stack__item.m-stack__item--left.body-info-company.m-stack__item--middle
                                          =  I18n.t("account_type.#{account['TipoCuenta']}")
                                      .m-stack.m-stack--ver.m-stack--general.m-stack--demo
                                        .m-stack__item.header-info-company.m-stack__item--left.m-stack__item--middle
                                          strong
                                            | Saldo actual
                                        .m-stack__item.m-stack__item--left.body-info-company.m-stack__item--middle
                                          = account['SaldoActual']
                                        .m-stack__item.header-info-company.m-stack__item--left.m-stack__item--middle
                                          strong
                                            | Saldo vencido
                                        .m-stack__item.m-stack__item--left.body-info-company.m-stack__item--middle
                                          = account['SaldoVencido']
                                        .m-stack__item.header-info-company.m-stack__item--left.m-stack__item--middle
                                          strong
                                            | Tipo de contrato
                                        .m-stack__item.m-stack__item--left.body-info-company.m-stack__item--middle
                                          =  I18n.t("contract_type.#{account['TipoContrato']}")
                                      .m-stack.m-stack--ver.m-stack--general.m-stack--demo
                                        .m-stack__item.header-info-company.m-stack__item--left.m-stack__item--middle
                                          strong
                                            | Crédito máximo
                                        .m-stack__item.m-stack__item--left.body-info-company.m-stack__item--middle
                                          = number_to_currency account['CreditoMaximo']
                                        .m-stack__item.header-info-company.m-stack__item--left.m-stack__item--middle
                                          strong
                                            | Forma de Pago
                                        .m-stack__item.m-stack__item--left.body-info-company.m-stack__item--middle
                                          = method_payment account['FormaPagoActual']
                                        .m-stack__item.header-info-company.m-stack__item--left.m-stack__item--middle
                                          strong
                                            | Frecuencia de pagos
                                        .m-stack__item.m-stack__item--left.body-info-company.m-stack__item--middle
                                          =  I18n.t("payments_frecuency.#{account['FrecuenciaPagos']}")
                                      .m-stack.m-stack--ver.m-stack--general.m-stack--demo.mt-2
                                        .m-stack__item.header-info-company.m-stack__item--left.m-stack__item--middle.d-flex.justify-content-between.align-items-center.history-header
                                          h4.strong
                                            | Historial de pagos
                                          .history-icon
                                            i.fa.fa-calendar-check.fa-2x.lightgray-text
                                      .m-stack.m-stack--ver.m-stack--general.m-stack--demo.history-table
                                        .m-stack__item.body-info-company.m-stack__item--middle
                                          strong
                                            | Mes
                                        .m-stack__item.body-info-company.m-stack__item--middle.text-center
                                          strong
                                            | E
                                        .m-stack__item.body-info-company.m-stack__item--middle.text-center
                                          strong
                                            | F
                                        .m-stack__item.body-info-company.m-stack__item--middle.text-center
                                          strong
                                            | M
                                        .m-stack__item.body-info-company.m-stack__item--middle.text-center
                                          strong
                                            | A
                                        .m-stack__item.body-info-company.m-stack__item--middle.text-center
                                          strong
                                            | M
                                        .m-stack__item.body-info-company.m-stack__item--middle.text-center
                                          strong
                                            | J
                                        .m-stack__item.body-info-company.m-stack__item--middle.text-center
                                          strong
                                            | J
                                        .m-stack__item.body-info-company.m-stack__item--middle.text-center
                                          strong
                                            | A
                                        .m-stack__item.body-info-company.m-stack__item--middle.text-center
                                          strong
                                            | S
                                        .m-stack__item.body-info-company.m-stack__item--middle.text-center
                                          strong
                                            | O
                                        .m-stack__item.body-info-company.m-stack__item--middle.text-center
                                          strong
                                            | N
                                        .m-stack__item.body-info-company.m-stack__item--middle.text-center
                                          strong
                                            | D
                                      - get_history_payments(account).each do |key, value|
                                        .m-stack.m-stack--ver.m-stack--general.m-stack--demo.history-table
                                          .m-stack__item.body-info-company.m-stack__item--middle
                                            = key
                                          - value.each do |v|
                                            - if v[:value] == 0
                                              .m-stack__item.body-info-company.m-stack__item--middle
                                            - elsif v[:value] == '1'
                                              .m-stack__item.body-info-one.m-stack__item--middle
                                                strong
                                                  = v[:value]
                                            - elsif v[:value] == '2'
                                              .m-stack__item.body-info-two.m-stack__item--middle
                                                strong
                                                  = v[:value]
                                            - else
                                              .m-stack__item.body-info-x.m-stack__item--middle
                                                strong
                                                  = v[:value]
                                      hr.dotted
                                  - else
                                    .m-stack.m-stack--ver.m-stack--general.m-stack--demo
                                      .m-alert.m-alert--icon.m-alert--icon-solid.m-alert--outline.alert.alert-brand.alert-dismissible.fade.show role="alert"
                                        .m-alert__icon
                                          i.flaticon-exclamation-1
                                          span
                                        .m-alert__text
                                          strong
                                            | Aún no se encuentran cuentas.
                                - else
                                  .m-stack.m-stack--ver.m-stack--general.m-stack--demo
                                    .m-alert.m-alert--icon.m-alert--icon-solid.m-alert--outline.alert.alert-brand.alert-dismissible.fade.show role="alert"
                                      .m-alert__icon
                                        i.flaticon-exclamation-1
                                        span
                                      .m-alert__text
                                        strong
                                          | Aún no se encuentran cuentas.
                            .m-demo data-code-html="true" data-code-js="false" data-code-preview="true"
                              .m-demo__preview
                                h3.m-portlet__head-text
                                  | Consultas
                                - if @credit_bureau.bureau_report.present?
                                  - @credit_bureau['bureau_report']['results'].each do |bureau_report|
                                    - if bureau_report['status']
                                      .m-stack.m-stack--ver.m-stack--general.m-stack--demo
                                        .m-stack__item.header-info-company.m-stack__item--left.m-stack__item--middle
                                          =  I18n.t("report_type.#{bureau_report['metadata']['reportType']}")
                                        .m-stack__item.header-info-company.m-stack__item--left.m-stack__item--middle
                                          = bureau_report['status']
                                        .m-stack__item.header-info-company.m-stack__item--left.m-stack__item--middle
                                          = bureau_report['createdAt'].to_datetime.strftime('%d-%m-%Y')
                                        .m-stack__item.header-info-company.m-stack__item--left.m-stack__item--middle
                                          a href="/credit_bureaus/#{bureau_report['id']}"
                                            |Ver reporte
                                - else
                                  .m-stack.m-stack--ver.m-stack--general.m-stack--demo
                                    .m-alert.m-alert--icon.m-alert--icon-solid.m-alert--outline.alert.alert-brand.alert-dismissible.fade.show role="alert"
                                      .m-alert__icon
                                        i.flaticon-exclamation-1
                                        span
                                      .m-alert__text
                                        strong
                                          | Aún no se encuentran consultas.

                          - elsif (@credit_bureau.present? and @company.try(:client_type).eql?('PM')) || (@credit_bureau.present? and @company.try(:client_type).eql?('PFAE'))

                            .m-demo data-code-html="true" data-code-js="false" data-code-preview="true"
                              .m-demo__preview
                                h3.m-portlet__head-text
                                .m-stack.m-stack--ver.m-stack--general.m-stack--demo
                                  - if @credit_bureau.present?
                                    - if @report_result['query'].present?
                                      .m-stack.m-stack--ver.m-stack--general.m-stack--demo
                                        .m-stack__item.header-info-company.m-stack__item--left.m-stack__item--middle
                                          strong
                                            | Calificación cartera
                                        .m-stack__item.m-stack__item--left.body-info-company.m-stack__item--middle
                                          - if @report_result['response']['respuesta']['datosGenerales'].present?
                                            strong
                                              = @report_result['response']['respuesta']['datosGenerales']['calificacionCartera'].present? ? @report_result['response']['respuesta']['datosGenerales']['calificacionCartera'].tr('0', '') : 'N/D'
                                          - else
                                            strong
                                              | N/D

                                    - else
                                      .m-alert.m-alert--icon.m-alert--icon-solid.m-alert--outline.alert.alert-brand.alert-dismissible.fade.show role="alert"
                                        .m-alert__icon
                                          i.flaticon-exclamation-1
                                          span
                                        .m-alert__text
                                          strong
                                            | Aún no se encuentra calificación.
                                  - else
                                    .m-alert.m-alert--icon.m-alert--icon-solid.m-alert--outline.alert.alert-brand.alert-dismissible.fade.show role="alert"
                                      .m-alert__icon
                                        i.flaticon-exclamation-1
                                        span
                                      .m-alert__text
                                        strong
                                          | Aún no se encuentra calificación.
                            .m-demo data-code-html="true" data-code-js="false" data-code-preview="true"
                              .m-demo__preview
                                h3.m-portlet__head-text
                                  | Datos Generales
                                .m-stack.m-stack--ver.m-stack--general.m-stack--demo
                                  - if @credit_bureau.present?
                                    - if @report_result['query'].present?
                                      .m-stack__item.header-info-company.m-stack__item--left.m-stack__item--middle
                                        strong
                                          | Nombre
                                      .m-stack__item.m-stack__item--left.body-info-company.m-stack__item--middle
                                        strong
                                          = @report_result['query']['consulta']['persona']['nombre']
                                      .m-stack__item.header-info-company.m-stack__item--left.m-stack__item--middle
                                        strong
                                          | R.F.C
                                      .m-stack__item.m-stack__item--left.body-info-company.m-stack__item--middle
                                        strong
                                          =  @report_result['query']['consulta']['persona']['rfc']

                                    - else
                                      .m-alert.m-alert--icon.m-alert--icon-solid.m-alert--outline.alert.alert-brand.alert-dismissible.fade.show role="alert"
                                        .m-alert__icon
                                          i.flaticon-exclamation-1
                                          span
                                        .m-alert__text
                                          strong
                                            | Aún no se encuentran datos generales.
                                  - else
                                    .m-alert.m-alert--icon.m-alert--icon-solid.m-alert--outline.alert.alert-brand.alert-dismissible.fade.show role="alert"
                                      .m-alert__icon
                                        i.flaticon-exclamation-1
                                        span
                                      .m-alert__text
                                        strong
                                          | Aún no se encuentran datos generales.

                            .m-demo data-code-html="true" data-code-js="false" data-code-preview="true"
                              .m-demo__preview
                                h3.m-portlet__head-text
                                  | Domicilio registrado
                                - if @credit_bureau.present?
                                  - if @report_result['query'].present?
                                    .m-stack.m-stack--ver.m-stack--general.m-stack--demo
                                      .m-stack__item.header-info-company.m-stack__item--left.m-stack__item--middle
                                        strong
                                          | Calle y número
                                      .m-stack__item.m-stack__item--left.body-info-company.m-stack__item--middle
                                        = @report_result['response']['respuesta']['datosGenerales'].present? ? @report_result['response']['respuesta']['datosGenerales']['direccion1'] : 'N/D'
                                      .m-stack__item.header-info-company.m-stack__item--left.m-stack__item--middle
                                        strong
                                          | Colonia
                                      .m-stack__item.m-stack__item--left.body-info-company.m-stack__item--middle
                                        = @report_result['response']['respuesta']['datosGenerales'].present? ? @report_result['response']['respuesta']['datosGenerales']['coloniaPoblacion'] : 'N/D'
                                      .m-stack__item.header-info-company.m-stack__item--left.m-stack__item--middle
                                        strong
                                          | Del / Mpio
                                      .m-stack__item.m-stack__item--left.body-info-company.m-stack__item--middle
                                        = @report_result['response']['respuesta']['datosGenerales'].present? ? @report_result['response']['respuesta']['datosGenerales']['delegacionMunicipio'] : 'N/D'
                                    .m-stack.m-stack--ver.m-stack--general.m-stack--demo
                                      .m-stack__item.header-info-company.m-stack__item--left.m-stack__item--middle
                                        strong
                                          | Estado
                                      .m-stack__item.m-stack__item--left.body-info-company.m-stack__item--middle
                                        = @report_result['response']['respuesta']['datosGenerales'].present? ? @report_result['response']['respuesta']['datosGenerales']['estado'] : 'N/D'
                                      .m-stack__item.header-info-company.m-stack__item--left.m-stack__item--middle
                                        strong
                                          | C.P
                                      .m-stack__item.m-stack__item--left.body-info-company.m-stack__item--middle
                                        = @report_result['response']['respuesta']['datosGenerales'].present? ? @report_result['response']['respuesta']['datosGenerales']['codigoPostal'] : 'N/D'
                                      .m-stack__item.header-info-company.m-stack__item--left.m-stack__item--middle
                                        strong
                                          | Teléfono
                                      .m-stack__item.m-stack__item--left.body-info-company.m-stack__item--middle
                                        = @report_result['response']['respuesta']['datosGenerales'].present? ? @report_result['response']['respuesta']['datosGenerales']['telefono'] : 'N/D'
                                    br
                                  - else
                                    .m-stack.m-stack--ver.m-stack--general.m-stack--demo
                                      .m-alert.m-alert--icon.m-alert--icon-solid.m-alert--outline.alert.alert-brand.alert-dismissible.fade.show role="alert"
                                        .m-alert__icon
                                          i.flaticon-exclamation-1
                                          span
                                        .m-alert__text
                                          strong
                                            | Aún no se encuentran domicilios registrados.
                                - else
                                  .m-stack.m-stack--ver.m-stack--general.m-stack--demo
                                    .m-alert.m-alert--icon.m-alert--icon-solid.m-alert--outline.alert.alert-brand.alert-dismissible.fade.show role="alert"
                                      .m-alert__icon
                                        i.flaticon-exclamation-1
                                        span
                                      .m-alert__text
                                        strong
                                          | Aún no se encuentran domicilios registrados.
                            .m-demo data-code-html="true" data-code-js="false" data-code-preview="true"
                              .m-demo__preview
                                h3.m-portlet__head-text
                                  | Créditos activos
                                - if @credit_bureau.bureau_report.present?
                                  - if @report_result['response'].present?
                                    .m-stack.m-stack--ver.m-stack--general.m-stack--demo
                                      .m-section
                                        .m-section__content
                                          table.table style="display: block;overflow-x: auto;"
                                            thead.thead-default
                                              tr
                                                th
                                                  | Tipo de Otorgante
                                                th
                                                  | Tipo de Crédito
                                                th
                                                  | Cuentas Abiertas
                                                th
                                                  Cuentas en MXP
                                                th
                                                  | Cuentas en USD
                                                th
                                                  | Otras Monedas
                                                th
                                                  | Original
                                                th
                                                  | Saldo Actual
                                                th
                                                  | Vigente
                                                th
                                                  | 1-29 días
                                                th
                                                  | 30-59 días
                                                th
                                                  | 60-89 días
                                                th
                                                  | 90-119 días
                                                th
                                                  | 120 - 179 días
                                                th
                                                  | 180+ días
                                            tbody
                                              - get_active_credits(@report_result['response']['respuesta']['creditoFinanciero']).each do |active_credit|
                                                tr
                                                  th
                                                    = active_credit[:otorgante]
                                                  th
                                                    = active_credit[:tipo_credito]
                                                  th
                                                    = active_credit[:cuentas_abiertas]
                                                  th
                                                    = active_credit[:cuentas_mxp]
                                                  th
                                                    = active_credit[:cuentas_usd]
                                                  th
                                                    = active_credit[:otras_monedas]
                                                  th
                                                    = number_to_currency active_credit[:original]
                                                  th
                                                    = number_to_currency active_credit[:saldo_actual]
                                                  th
                                                    = number_to_currency  active_credit[:vigente]
                                                  th
                                                    = active_credit[:one]
                                                  th
                                                    = active_credit[:thirty]
                                                  th
                                                    = active_credit[:sixty]
                                                  th
                                                    = active_credit[:ninety]
                                                  th
                                                    = active_credit[:one_twenty]
                                                  th
                                                    = active_credit[:one_eighty]
                                              - get_total_active_credits(@report_result['response']['respuesta']['creditoFinanciero']).each do |active_credit|
                                                tr
                                                  th colspan="2"
                                                    | Total
                                                  th
                                                    = active_credit[:cuentas_abiertas]
                                                  th
                                                    = active_credit[:cuentas_mxp]
                                                  th
                                                    = active_credit[:cuentas_usd]
                                                  th
                                                    = active_credit[:otras_monedas]
                                                  th
                                                    = number_to_currency active_credit[:original]
                                                  th
                                                    = number_to_currency active_credit[:saldo_actual]
                                                  th
                                                    = number_to_currency active_credit[:vigente]
                                                  th
                                                    = active_credit[:one]
                                                  th
                                                    = active_credit[:thirty]
                                                  th
                                                    = active_credit[:sixty]
                                                  th
                                                    = active_credit[:ninety]
                                                  th
                                                    = active_credit[:one_twenty]
                                                  th
                                                    = active_credit[:one_eighty]

                                  - else
                                    .m-stack.m-stack--ver.m-stack--general.m-stack--demo
                                      .m-alert.m-alert--icon.m-alert--icon-solid.m-alert--outline.alert.alert-brand.alert-dismissible.fade.show role="alert"
                                        .m-alert__icon
                                          i.flaticon-exclamation-1
                                          span
                                        .m-alert__text
                                          strong
                                            | Aún no se encuentran creditos activos.
                                - else
                                  .m-stack.m-stack--ver.m-stack--general.m-stack--demo
                                    .m-alert.m-alert--icon.m-alert--icon-solid.m-alert--outline.alert.alert-brand.alert-dismissible.fade.show role="alert"
                                      .m-alert__icon
                                        i.flaticon-exclamation-1
                                        span
                                      .m-alert__text
                                        strong
                                          | Aún no se encuentran creditos activos.
                            .m-demo data-code-html="true" data-code-js="false" data-code-preview="true"
                              .m-demo__preview
                                h3.m-portlet__head-text
                                  | Historia
                                - if @credit_bureau.present?
                                  - if @report_result['response'].present?
                                    .m-stack.m-stack--ver.m-stack--general.m-stack--demo
                                      .m-section
                                        .m-section__content
                                          table.table style="display: block;overflow-x: auto;"
                                            thead.thead-default
                                              tr
                                                th
                                                - @report_result['response']['respuesta']['historia'].each do |historia|
                                                  th
                                                    = get_date historia['periodo']
                                            tbody
                                              tr
                                                th
                                                  | Vigente
                                                - @report_result['response']['respuesta']['historia'].each do |historia|
                                                  th
                                                    = number_to_currency historia['saldoVigente']
                                              tr
                                                th
                                                  | Vencido de 1 a 29 días
                                                - @report_result['response']['respuesta']['historia'].each do |historia|
                                                  th
                                                    = number_to_currency historia['saldoVencidoA90Dias']
                                              tr
                                                th
                                                  | Vencido de 30 a 59 días
                                                - @report_result['response']['respuesta']['historia'].each do |historia|
                                                  th
                                                    = number_to_currency historia['saldoVencido1A29Dias']
                                              tr
                                                th
                                                  | Vencido de 60 a 89 días
                                                - @report_result['response']['respuesta']['historia'].each do |historia|
                                                  th
                                                    = number_to_currency historia['saldoVencido30A59Dias']
                                              tr
                                                th
                                                  | Vencido de a mas de 89 días
                                                - @report_result['response']['respuesta']['historia'].each do |historia|
                                                  th
                                                    = number_to_currency historia['saldoVencido60A89Dias']
                                              tr
                                                th
                                                  | Calificación de cartera
                                                - @report_result['response']['respuesta']['historia'].each do |historia|
                                                  th
                                                    = historia['calificacioncartera'].present? ? historia['calificacioncartera'] : 'N/D'

                                  - else
                                    .m-stack.m-stack--ver.m-stack--general.m-stack--demo
                                      .m-alert.m-alert--icon.m-alert--icon-solid.m-alert--outline.alert.alert-brand.alert-dismissible.fade.show role="alert"
                                        .m-alert__icon
                                          i.flaticon-exclamation-1
                                          span
                                        .m-alert__text
                                          strong
                                            | Aún no se encuentran creditos activos.
                                - else
                                  .m-stack.m-stack--ver.m-stack--general.m-stack--demo
                                    .m-alert.m-alert--icon.m-alert--icon-solid.m-alert--outline.alert.alert-brand.alert-dismissible.fade.show role="alert"
                                      .m-alert__icon
                                        i.flaticon-exclamation-1
                                        span
                                      .m-alert__text
                                        strong
                                          | Aún no se encuentran creditos activos.

                            .m-demo data-code-html="true" data-code-js="false" data-code-preview="true"
                              .m-demo__preview
                                h3.m-portlet__head-text
                                  | Consultas
                                - if false
                                /- if @credit_bureau.bureau_report.present?
                                  - @credit_bureau['bureau_report']['results'].each do |bureau_report|
                                    - if bureau_report['status']
                                      .m-stack.m-stack--ver.m-stack--general.m-stack--demo
                                        .m-stack__item.header-info-company.m-stack__item--left.m-stack__item--middle
                                          /= I18n.t("report_type.#{bureau_report['metadata']['reportType']}")
                                          = bureau_report['metadata']['reportType']
                                        .m-stack__item.header-info-company.m-stack__item--left.m-stack__item--middle
                                          = bureau_report['status']
                                        .m-stack__item.header-info-company.m-stack__item--left.m-stack__item--middle
                                          = bureau_report['createdAt'].to_datetime.strftime('%d-%m-%Y')
                                        .m-stack__item.header-info-company.m-stack__item--left.m-stack__item--middle
                                          a href="/credit_bureaus/#{bureau_report['id']}"
                                            |Ver reporte
                                - else
                                  .m-stack.m-stack--ver.m-stack--general.m-stack--demo
                                    .m-alert.m-alert--icon.m-alert--icon-solid.m-alert--outline.alert.alert-brand.alert-dismissible.fade.show role="alert"
                                      .m-alert__icon
                                        i.flaticon-exclamation-1
                                        span
                                      .m-alert__text
                                        strong
                                          | Aún no se encuentran consultas.
                          - else
                            .m-alert.m-alert--icon.m-alert--icon-solid.m-alert--outline.alert.alert-brand.alert-dismissible.fade.show role="alert"
                              .m-alert__icon
                                i.flaticon-exclamation-1
                                span
                              .m-alert__text
                                strong
                                  | Aún no se le ha asignado el buró de crédito.

            .tab-pane id="info_sat"
              .col-xl-12
                .m-portlet
                  .m-portlet__body
                    .m-section.mb-0
                      - if !@company.present?
                        .m-section__content
                          .no-results

                      - else
                      .m-section__sub
                        .row.m-section__sub style="display: flex"
                          .col-6.pl-0

                          .col-6.per-page-container

                      - if @company.info_company.present?
                        - if @company.info_company['hydra:member'].present?
                          .m-section__content
                            .m-demo data-code-html="true" data-code-js="false" data-code-preview="true"

                              - if @company.info_company['hydra:member'].try(:first)['person'].present?
                                .m-demo__preview
                                  h3.m-portlet__head-text
                                    | Contribuyente
                                  .m-stack.m-stack--ver.m-stack--general.m-stack--demo
                                    .m-stack__item.header-info-company.m-stack__item--left.m-stack__item--middle
                                      strong
                                        | R.F.C
                                    .m-stack__item.m-stack__item--left.body-info-company.m-stack__item--middle
                                      = @company.info_company['hydra:member'].try(:first)['rfc']
                                    .m-stack__item.header-info-company.m-stack__item--left.m-stack__item--middle
                                      strong
                                        | CIF
                                    .m-stack__item.m-stack__item--left.body-info-company.m-stack__item--middle
                                      = @company.info_company['hydra:member'].try(:first)['cif']
                                    .m-stack__item.header-info-company.m-stack__item--left.m-stack__item--middle
                                      strong
                                        | Estatus
                                    .m-stack__item.m-stack__item--left.body-info-company.m-stack__item--middle
                                      = @company.info_company['hydra:member'].try(:first)['status']
                                  .m-stack.m-stack--ver.m-stack--general.m-stack--demo
                                    .m-stack__item.header-info-company.m-stack__item--left.m-stack__item--middle
                                      strong
                                        | Inició operaciones en
                                    .m-stack__item.m-stack__item--left.body-info-company.m-stack__item--middle
                                      = @company.info_company['hydra:member'].try(:first)['startedOperationsAt']
                                    .m-stack__item.header-info-company.m-stack__item--left.m-stack__item--middle
                                      strong
                                        | Estado actualizado en
                                    .m-stack__item.m-stack__item--left.body-info-company.m-stack__item--middle
                                      = @company.info_company['hydra:member'].try(:first)['statusUpdatedAt']
                                    .m-stack__item.header-info-company.m-stack__item--left.m-stack__item--middle
                                      strong
                                        | CURP
                                    .m-stack__item.m-stack__item--left.body-info-company.m-stack__item--middle
                                      = @company.info_company['hydra:member'].try(:first)['person']['curp']
                                  .m-stack.m-stack--ver.m-stack--general.m-stack--demo
                                    .m-stack__item.header-info-company.m-stack__item--left.m-stack__item--middle
                                      strong
                                        | Nombre
                                    .m-stack__item.m-stack__item--left.body-info-company.m-stack__item--middle
                                      = @company.info_company['hydra:member'].try(:first)['person']['firstName']
                                    .m-stack__item.header-info-company.m-stack__item--left.m-stack__item--middle
                                      strong
                                        | Apellido Paterno
                                    .m-stack__item.m-stack__item--left.body-info-company.m-stack__item--middle
                                      = @company.info_company['hydra:member'].try(:first)['person']['middleName']
                                    .m-stack__item.header-info-company.m-stack__item--left.m-stack__item--middle
                                      strong
                                        | Apellido Materno
                                    .m-stack__item.m-stack__item--left.body-info-company.m-stack__item--middle
                                      = @company.info_company['hydra:member'].try(:first)['person']['lastName']
                              - else
                                .m-demo__preview
                                  h3.m-portlet__head-text
                                    | Contribuyente
                                  .m-stack.m-stack--ver.m-stack--general.m-stack--demo
                                    .m-stack__item.header-info-company.m-stack__item--left.m-stack__item--middle
                                      strong
                                        | R.F.C
                                    .m-stack__item.m-stack__item--left.body-info-company.m-stack__item--middle
                                      = @company.info_company['hydra:member'].try(:first)['rfc']
                                    .m-stack__item.header-info-company.m-stack__item--left.m-stack__item--middle
                                      strong
                                        | CIF
                                    .m-stack__item.m-stack__item--left.body-info-company.m-stack__item--middle
                                      = @company.info_company['hydra:member'].try(:first)['cif']
                                    .m-stack__item.header-info-company.m-stack__item--left.m-stack__item--middle
                                      strong
                                        | Estatus
                                    .m-stack__item.m-stack__item--left.body-info-company.m-stack__item--middle
                                      = @company.info_company['hydra:member'].try(:first)['status']
                                  .m-stack.m-stack--ver.m-stack--general.m-stack--demo
                                    .m-stack__item.header-info-company.m-stack__item--center.m-stack__item--middle
                                      strong
                                        | Inició operaciones en
                                    .m-stack__item.m-stack__item--left.body-info-company.m-stack__item--middle
                                      = @company.info_company['hydra:member'].try(:first)['startedOperationsAt']
                                    .m-stack__item.header-info-company.m-stack__item--left.m-stack__item--middle
                                      strong
                                        | Estado actualizado en
                                    .m-stack__item.m-stack__item--left.body-info-company.m-stack__item--middle
                                      = @company.info_company['hydra:member'].try(:first)['statusUpdatedAt']
                                    .m-stack__item.header-info-company.m-stack__item--left.m-stack__item--middle
                                      strong
                                        | Nombre legal
                                    .m-stack__item.m-stack__item--left.body-info-company.m-stack__item--middle
                                      = @company.info_company['hydra:member'].try(:first)['company']['legalName']
                                  .m-stack.m-stack--ver.m-stack--general.m-stack--demo
                                    .m-stack__item.header-info-company.m-stack__item--center.m-stack__item--middle
                                      strong
                                        | Tipo de entidad
                                    .m-stack__item.m-stack__item--left.body-info-company.m-stack__item--middle
                                      = @company.info_company['hydra:member'].try(:first)['company']['entityType']
                                    .m-stack__item.header-info-company.m-stack__item--center.m-stack__item--middle
                                      strong
                                        | Nombre comercial
                                    .m-stack__item.m-stack__item--left.body-info-company.m-stack__item--middle
                                      = @company.info_company['hydra:member'].try(:first)['company']['tradeName']

                            .m-demo data-code-html="true" data-code-js="false" data-code-preview="true"
                              .m-demo__preview
                                h3.m-portlet__head-text
                                  | Dirección
                                .m-stack.m-stack--ver.m-stack--general.m-stack--demo
                                  .m-stack__item.header-info-company.m-stack__item--left.m-stack__item--middle
                                    strong
                                      | Código postal
                                  .m-stack__item.m-stack__item--left.body-info-company.m-stack__item--middle
                                    = @company.info_company['hydra:member'].try(:first)['address']['postalCode']
                                  .m-stack__item.header-info-company.m-stack__item--left.m-stack__item--middle
                                    strong
                                      | Tipo de calle
                                  .m-stack__item.m-stack__item--left.body-info-company.m-stack__item--middle
                                    = @company.info_company['hydra:member'].try(:first)['address']['streetType']
                                  .m-stack__item.header-info-company.m-stack__item--left.m-stack__item--middle
                                    strong
                                      | Nombre de la calle
                                  .m-stack__item.m-stack__item--left.body-info-company.m-stack__item--middle
                                    = @company.info_company['hydra:member'].try(:first)['address']['streetName']
                                .m-stack.m-stack--ver.m-stack--general.m-stack--demo
                                  .m-stack__item.header-info-company.m-stack__item--left.m-stack__item--middle
                                    strong
                                      | Referencias de calles
                                  .m-stack__item.m-stack__item--left.body-info-company.m-stack__item--middle
                                    - @company.info_company['hydra:member'].try(:first)['address']['streetReferences'].each do |references|
                                      = references.to_s + ' '
                                  .m-stack__item.header-info-company.m-stack__item--left.m-stack__item--middle
                                    strong
                                      | Número exterior
                                  .m-stack__item.m-stack__item--left.body-info-company.m-stack__item--middle
                                    = @company.info_company['hydra:member'].try(:first)['address']['streetNumber']
                                  .m-stack__item.header-info-company.m-stack__item--left.m-stack__item--middle
                                    strong
                                      | Número interior
                                  .m-stack__item.m-stack__item--left.body-info-company.m-stack__item--middle
                                    = @company.info_company['hydra:member'].try(:first)['address']['buildingNumber']
                                .m-stack.m-stack--ver.m-stack--general.m-stack--demo
                                  .m-stack__item.header-info-company.m-stack__item--left.m-stack__item--middle
                                    strong
                                      | Vecindario
                                  .m-stack__item.m-stack__item--left.body-info-company.m-stack__item--middle
                                    = @company.info_company['hydra:member'].try(:first)['address']['neighborhood']
                                  .m-stack__item.header-info-company.m-stack__item--left.m-stack__item--middle
                                    strong
                                      | Localidad
                                  .m-stack__item.m-stack__item--left.body-info-company.m-stack__item--middle
                                    = @company.info_company['hydra:member'].try(:first)['address']['locality']
                                  .m-stack__item.header-info-company.m-stack__item--left.m-stack__item--middle
                                    strong
                                      | Municipio
                                  .m-stack__item.m-stack__item--left.body-info-company.m-stack__item--middle
                                    = @company.info_company['hydra:member'].try(:first)['address']['municipality']
                                .m-stack.m-stack--ver.m-stack--general.m-stack--demo
                                  .m-stack__item.header-info-company.m-stack__item--left.m-stack__item--middle
                                    strong
                                      | Estado
                                  .m-stack__item.m-stack__item--left.body-info-company.m-stack__item--middle
                                    = @company.info_company['hydra:member'].try(:first)['address']['state']
                                  .m-stack__item.header-info-company.m-stack__item--left.m-stack__item--middle
                                    strong
                                      | Email
                                  .m-stack__item.m-stack__item--left.body-info-company.m-stack__item--middle
                                    = @company.info_company['hydra:member'].try(:first)['email']
                                  .m-stack__item.header-info-company.m-stack__item--left.m-stack__item--middle
                                    strong
                                      | Teléfono
                                  .m-stack__item.m-stack__item--left.body-info-company.m-stack__item--middle
                                    = @company.info_company['hydra:member'].try(:first)['phone']

                            .m-section
                              .m-demo data-code-html="true" data-code-js="false" data-code-preview="true"
                                .m-demo__preview
                                  h3.m-portlet__head-text
                                    | Actividades económicas
                                  .m-section__content
                                    table.table
                                      thead.thead-default.thead-custom
                                        tr style="text-align: center;"
                                          th
                                            | Orden
                                          th
                                            | Actividad económica
                                          th
                                            | Porcentaje
                                          th
                                            | Fecha inicial
                                          th
                                            | Fecha final
                                      tbody
                                        - @company.info_company['hydra:member'].try(:first)['economicActivities'].each do |economic_activities|
                                          tr
                                            td
                                              = economic_activities['order']
                                            td
                                              = economic_activities['name']
                                            td
                                              = economic_activities['percentage']
                                            td
                                              = economic_activities['startDate']
                                            td
                                              = economic_activities['endDate']
                            .m-section
                              .m-demo data-code-html="true" data-code-js="false" data-code-preview="true"
                                .m-demo__preview
                                  h3.m-portlet__head-text
                                    | Regímenes
                                  .m-section__content
                                    table.table
                                      thead.thead-default.thead-custom
                                        tr style="text-align: center;"
                                          th
                                            | Régimen
                                          th
                                            | Fecha inicial
                                          th
                                            | Fecha final
                                      tbody
                                        - @company.info_company['hydra:member'].try(:first)['taxRegimes'].each do |regime|
                                          tr
                                            td
                                              = regime['name']
                                            td
                                              = regime['startDate']
                                            td
                                              = regime['endDate']

                            .m-section
                              .m-demo data-code-html="true" data-code-js="false" data-code-preview="true"
                                .m-demo__preview
                                  h3.m-portlet__head-text
                                    | Obligaciones
                                  .m-section__content
                                    table.table
                                      thead.thead-default.thead-custom
                                        tr style="text-align: center;"
                                          th
                                            | Descripción de la obligación
                                          th
                                            | Fecha de vencimiento
                                          th
                                            | Fecha inicial
                                          th
                                            | Fecha final
                                      tbody
                                        - @company.info_company['hydra:member'].try(:first)['obligations'].each do |obligation|
                                          tr
                                            td
                                              = obligation['description']
                                            td
                                              = obligation['dueDate']
                                            td
                                              = obligation['startDate']
                                            td
                                              = obligation['endDate']
                        - else
                          .m-alert.m-alert--icon.m-alert--icon-solid.m-alert--outline.alert.alert-brand.alert-dismissible.fade.show role="alert"
                            .m-alert__icon
                              i.flaticon-exclamation-1
                              span
                            .m-alert__text
                              strong
                                | Aún no se le ha asignado información del SAT.
                      - else
                        .m-alert.m-alert--icon.m-alert--icon-solid.m-alert--outline.alert.alert-brand.alert-dismissible.fade.show role="alert"
                          .m-alert__icon
                            i.flaticon-exclamation-1
                            span
                          .m-alert__text
                            strong
                              | Aún no se le ha asignado información del SAT.
            .tab-pane id="providers_clients"
              .col-xl-12
                .m-portlet
                  .m-portlet__body
                    .m-section.mb-0
                      - if !@company.try(:providers).present? && !@company.try(:customers).present?
                        .m-section__content
                          .no-results

                      - else
                      .m-section__sub
                        .row.m-section__sub style="display: flex"
                          .col-xl-12.my-6
                            ul.nav.select_form_switch.select-form-switch-two role="tablist"
                              li.nav-item.active
                                a.nav-link data-toggle="tab" href="#providers"
                                  | Proveedores
                              li.nav-item
                                a.nav-link data-toggle="tab" href="#customers"
                                  | Clientes
                              li.slide
                          .tab-content.col-xl-12.mb-30 style="margin-top: 20px!important"
                            .tab-pane.active id="providers"
                              .col-xl-12
                                .m-portlet
                                  .m-portlet__body
                                    .m-section__content
                                      -if @company.try(:providers).present?
                                        table.table
                                          thead.thead-default.thead-custom
                                            tr style="text-align: center;"
                                              th
                                                | R.F.C
                                              th
                                                | Nombre
                                              th
                                                | Total
                                              th
                                                | Acciones
                                          tbody
                                            - @company.try(:providers)['data'].each do |provider|
                                              tr style="text-align: center;"
                                                td
                                                  = provider['rfc']
                                                td
                                                  = provider['name']
                                                td
                                                  = number_to_currency provider['total']
                                                td
                                                  button type="button" class="btn btn-primary" data-toggle="modal" data-transactions="#{provider['transactions'].to_json}" data-target="#modal_providers"
                                                    | Ver transacciones
                                      - else
                                        .m-alert.m-alert--icon.m-alert--icon-solid.m-alert--outline.alert.alert-brand.alert-dismissible.fade.show role="alert"
                                          .m-alert__icon
                                            i.flaticon-exclamation-1
                                            span
                                          .m-alert__text
                                            strong
                                              | Aún no se le han asignado proveedores a la compañía.

                            .tab-pane id="customers"
                              .col-xl-12
                                .m-portlet
                                  .m-portlet__body
                                    .m-section__content
                                      - if  @company.try(:customers).present?
                                        table.table
                                          thead.thead-default.thead-custom
                                            tr style="text-align: center;"
                                              th
                                                | R.F.C
                                              th
                                                | Nombre
                                              th
                                                | Total
                                              th
                                                | Acciones
                                          tbody
                                            - @company.try(:customers)['data'].each do |customer|
                                              tr style="text-align: center;"
                                                td
                                                  = customer['rfc']
                                                td
                                                  = customer['name']
                                                td
                                                  = number_to_currency customer['total']
                                                td
                                                  button type="button" class="btn btn-primary" data-toggle="modal" data-transactions="#{customer['transactions'].to_json}" data-target="#modal_customers"
                                                    | Ver transacciones
                                      - else
                                        .m-alert.m-alert--icon.m-alert--icon-solid.m-alert--outline.alert.alert-brand.alert-dismissible.fade.show role="alert"
                                          .m-alert__icon
                                            i.flaticon-exclamation-1
                                            span
                                          .m-alert__text
                                            strong
                                              | Aún no se le han asignado clientes a la compañía.

            .tab-pane id="cash_flow"
              .col-xl-12
                .m-portlet
                  .m-portlet__body
                    .m-section.mb-0
                      .m-section__sub
                        .row.m-section__sub style="display: flex"
                          .col-xl-12.my-6
                            .tab-content.col-xl-12.mb-30
                              .m-portlet
                                .m-portlet__body
                                  .m-section__content
                                    - if @cash_flow.present?
                                      table.table
                                        thead.thead-default.thead-custom
                                          tr style="text-align: center;"
                                            th
                                              | Fecha
                                            th
                                              | Entrada
                                            th
                                              | Salida
                                            th
                                              | Moneda
                                        tbody
                                          - @cash_flow.reverse_each do |cash_flow|
                                            tr style="text-align: center;"
                                              td
                                                = cash_flow[0].first
                                              td
                                                = number_to_currency(cash_flow[1].try(:first)['amount'].present? ? cash_flow[1].try(:first)['amount'] : 0)
                                              td
                                                - if cash_flow[1].count > 1
                                                  =  number_to_currency(cash_flow[1].try(:last)['amount'].present? ? cash_flow[1].try(:last)['amount'] : 0)
                                                - else
                                                  = number_to_currency 0
                                              td
                                                = cash_flow[1].try(:first)['currency']
                                    - else
                                      .m-alert.m-alert--icon.m-alert--icon-solid.m-alert--outline.alert.alert-brand.alert-dismissible.fade.show role="alert"
                                        .m-alert__icon
                                          i.flaticon-exclamation-1
                                          span
                                        .m-alert__text
                                          strong
                                            | Aún no se le han asignado flujo de efectivo a la compañía.




#m_modal_1.modal.fade aria-hidden="true" aria-labelledby="exampleModalLabel" role="dialog" tabindex="-1"
  .modal-dialog role="document" style="margin-top: 0%;"
    .modal-content
      .modal-header
        h5#titleModalLabel.modal-title
        button.close aria-label="Close" data-dismiss="modal" type="button"
          span aria-hidden="true"
            | \&times;
      = form_for current_user, url: validate_company_path, method: 'PUT',class: 'class="m-form m-form--fit m-form--label-align-right m-form--group-seperator-dashed' do |f|
        .modal-body
          input type="hidden" name="id" id="companyId" value=""
          input type="hidden" name="approved" id="companyApproved" value=""
          p#textModal
            | Se va a validar la compañía para que pueda acceder al sistema.
        .modal-footer
          button.btn.btn-secondary data-dismiss="modal" type="button"
            | Cerrar
          button#idBtn.btn.btn-success type="submit"
            | Validar

#m_modal_capture_status.modal.fade aria-hidden="true" aria-labelledby="exampleModalLabel" role="dialog" tabindex="-1"
  .modal-dialog role="document" style="margin-top: 0%;"
    .modal-content
      .modal-header
        h5#titleModalLabel.modal-title
        button.close aria-label="Close" data-dismiss="modal" type="button"
          span aria-hidden="true"
            | \&times;
      = form_for current_user, url: change_capture_status_path, method: 'PUT',class: 'class="m-form m-form--fit m-form--label-align-right m-form--group-seperator-dashed' do |f|
        .modal-body
          input type="hidden" name="id"           id="companyId"   value=""
          input type="hidden" name="capture_type" id="captureType" value=""
          p#textModal
            | Se va a habilitar esta captura para la compañía.
        .modal-footer
          button.btn.btn-secondary data-dismiss="modal" type="button"
            | Cerrar
          button#idBtn.btn.btn-success type="submit"
            | Validar

#m_modal_periods.modal.fade aria-hidden="true" aria-labelledby="exampleModalLabel" role="dialog" tabindex="-1"
  .modal-dialog role="document" style="margin-top: 0%;"
    .modal-content
      .modal-header
        h5#titleModalLabel.modal-title
        button.close aria-label="Close" data-dismiss="modal" type="button"
          span aria-hidden="true"
            | \&times;
      = form_for current_user, url: assign_calendar_path, method: 'PUT', class: 'class="m-form m-form--fit m-form--label-align-right m-form--group-seperator-dashed' do |f|
        .modal-body
          p#textModal
            | Asignar
          .col-xl-12 style="display: grid;"
            input type="hidden" name="company_id" id="companyId" value=""
            /input type="hidden" name="assign_to" id="companyAssignTo" value=""
            select.select2.select2-container.select2-multiple#company_balance_calendars multiple="multiple" name="periods[]"
              = @periods.each do |period|
                option value="#{period.id}"= period.period_name
        .modal-footer
          button.btn.btn-secondary data-dismiss="modal" type="button"
            | Cerrar
          button#idBtn.btn.btn-success type="submit"
            | Guardar


#m_modal_request_details.modal.fade aria-hidden="true" aria-labelledby="exampleModalLabel" role="dialog" tabindex="-1"
  .modal-dialog role="document" style="margin-top: 0%;"
    .modal-content
      .modal-header
        h5#titleModalLabel.modal-title
        button.close aria-label="Close" data-dismiss="modal" type="button"
          span aria-hidden="true"
            | \&times;
      = form_for current_user, url: assign_details_to_request_path, method: 'PUT', class: 'class="m-form m-form--fit m-form--label-align-right m-form--group-seperator-dashed' do |f|
        .modal-body
          input type="hidden" name="request_id" id="requestId" value=""
          input type="hidden" name="company_id" id="companyId" value=""
          .col-xl-12 style="display: grid;"
            p#textModal
              | Asignar Analista
            = select("request", "analyst_id", User.where(role_id: Role.find_by(key:'analyst').try(:id)).collect {|p| [ p.full_name, p.id ] }, { include_blank: 'Selecciona analista' }, {class: "form-control m-input", disabled: (current_user.god? or current_user.credit_management? or current_user.credit_area? or current_user.promotion_area?) ? false : true })

          - if @company.company_calendar_details.present?
            .col-xl-12#input_credit_type style="display: none;"
              p.mt-20#textModal
                | Asignar Tipo de Crédito
              div style="display: grid;"
                = select("request", "factor_credit_id", FactorCredit.all.collect { |p| [p.name, p.id] }, {include_blank: 'Selecciona tipo de crédito'}, {class: "form-control m-input"})
                /= select("request", "factor_credit_id", FactorCredit.where.not(id:@requests.pluck(:factor_credit_id)).collect { |p| [p.name, p.id] }, {include_blank: 'Selecciona tipo de crédito'}, {class: "form-control m-input"})
          /- if @request.try(:order).present?
            - if @request.try(:order) >= 2
          .col-xl-12#input_status_process style="display: none;"
            p.mt-20#textModal
              | Asignar Status del Proceso
            div style="display: grid;"
              = select("request", "process_status_id", ProcessStatus.all.collect {|p| [ p.name, p.id ] }, { include_blank: false, selected: @request.try(:process_status_id) }, {class: "form-control m-input"})
        .modal-footer
          button.btn.btn-secondary data-dismiss="modal" type="button"
            | Cerrar
          button#idBtn.btn.btn-success type="submit"
            | Guardar

#m_modal_file_request.modal.fade aria-hidden="true" aria-labelledby="exampleModalLabel" role="dialog" tabindex="-1"
  .modal-dialog role="document" style="margin-top: 0%;"
    .modal-content
      .modal-header
        h5.modal-title
          | Adjuntar Estudio de Crédito
        button.close aria-label="Close" data-dismiss="modal" type="button"
          span aria-hidden="true"
            | \&times;
      = form_for current_user, url: assign_pdf_to_request_path, method: 'PUT', class: 'class="m-form m-form--fit m-form--label-align-right m-form--group-seperator-dashed',html: { multipart: true } do |f|
        .modal-body
          input type="hidden" name="request_id" id="requestIdFile" value=""
          .col-xl-12 style="display: grid;"
            = f.file_field :file_name, class: "custom-file-input", required: true,accept: "application/pdf"
            label.custom-file-label Elige un archivo...
            span.custom-file-control
        .modal-footer
          button.btn.btn-secondary data-dismiss="modal" type="button"
            | Cerrar
          button.btn.btn-success type="submit"
            | Guardar

#m_modal_financial_institutions.modal.fade aria-hidden="true" aria-labelledby="exampleModalLabel" role="dialog" tabindex="-1"
  .modal-dialog role="document" style="margin-top: 0%;"
    .modal-content
      .modal-header
        h5.modal-title
          = 'Instituciones financieras'
        button.close aria-label="Close" data-dismiss="modal" type="button"
          span aria-hidden="true"
            | \&times;
      .modal-body
        .col-xl-12 style="display: grid;"
          - @financial_inst.each do |fin_inst|
            .m-portlet.p-4
              .row
                .col-sm-6.d-flex.justify-content-between
                  span
                    strong.mr-2 = 'Institución'
                  span = fin_inst.institution
                .col-sm-6.d-flex.justify-content-between
                  span
                    strong.mr-2 = 'Tipo de Crédito'
                  span = CreditType.where(id: fin_inst.credit_type_id).first.try(:name)
              .row
                .col-sm-6.d-flex.justify-content-between
                  span
                    strong.mr-2 = 'Línea Autorizada'
                  span = fin_inst.authorized_line
                .col-sm-6.d-flex.justify-content-between
                  span
                    strong.mr-2 =  'Saldo'
                  span =  fin_inst.balance
              .row
                .col-sm-6.d-flex.justify-content-between
                  span
                    strong.mr-2 = 'Tipo de contrato'
                  span = fin_inst.type_contract
                .col-sm-6.d-flex.justify-content-between
                  span
                    strong.mr-2 = 'Moneda'
                  span = fin_inst.coin
              .row
                .col-sm-6.d-flex.justify-content-between
                  span
                    strong.mr-2 = 'Garantía'
                  span = fin_inst.warranty
                .col-sm-6.d-flex.justify-content-between
                  span
                    strong.mr-2 = 'Tasa'
                  span = fin_inst.rate
              .row
                .col-sm-6.d-flex.justify-content-between
                  span
                    strong.mr-2 = 'Vencimiento'
                  span = fin_inst.expiration
                .col-sm-6.d-flex.justify-content-between
                  span
                    strong.mr-2 = 'Destíno'
                  span = fin_inst.destiny

      .modal-footer
        button.btn.btn-secondary data-dismiss="modal" type="button"
          | Cerrar

#modal_providers.modal.fade aria-hidden="true" aria-labelledby="exampleModalLabel" role="dialog" tabindex="-1"
  .modal-dialog role="document" style="margin-top: 0%;"
    .modal-content
      .modal-header
        h5.modal-title
          | Transacciones
        button.close aria-label="Close" data-dismiss="modal" type="button"
          span aria-hidden="true"
            | \&times;
      .modal-body
        .m-section__content
          select.orm-control.m-input.form-control-lg.upcase-txt prompt="true" id="selectProviders" onchange="getTransactionsForYearProviders(this)"
          .table-scrollable id="divTransactions"

      .modal-footer
        button.btn.btn-secondary data-dismiss="modal" type="button"
          | Cerrar
#modal_customers.modal.fade aria-hidden="true" aria-labelledby="exampleModaabel" role="dialog" tabindex="-1"
  .modal-dialog role="document" style="margin-top: 0%;"
    .modal-content
      .modal-header
        h5.modal-title
          | Transacciones
        button.close aria-label="Close" data-dismiss="modal" type="button"
          span aria-hidden="true"
            | \&times;
      .modal-body
        .m-section__content
          select.orm-control.m-input.form-control-lg.upcase-txt prompt="true" id="selectProvidersCustomers" onchange="getTransactionsForYearCustomers(this)"
          .table-scrollable id="divCustomersTransactions"

      .modal-footer
        button.btn.btn-secondary data-dismiss="modal" type="button"
          | Cerrar